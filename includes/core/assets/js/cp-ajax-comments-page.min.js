function cpajax_reenable_featured_comments(){"undefined"!=typeof featured_comments&&jQuery.is_function_defined("featured_comments_click")&&featured_comments_click()}function cpajax_reenable_comment_upvoter(){"undefined"!=typeof comment_upvoter&&jQuery.is_function_defined("comment_upvoter_click")&&comment_upvoter_click()}CommentPress.ajax={},CommentPress.ajax.comments=new function(){var e=this,t=jQuery.noConflict();this.cpajax_submitting=!1,this.cpajax_form={},this.cpajax_error={},"undefined"!=typeof CommentPress_AJAX_Settings&&(this.cpajax_live=CommentPress_AJAX_Settings.cpajax_live,this.cpajax_ajax_url=CommentPress_AJAX_Settings.cpajax_ajax_url,this.cpajax_spinner_url=CommentPress_AJAX_Settings.cpajax_spinner_url,this.cpajax_post_id=CommentPress_AJAX_Settings.cpajax_post_id,this.cpajax_lang=CommentPress_AJAX_Settings.cpajax_lang,this.cpajax_nonce=CommentPress_AJAX_Settings.cpajax_nonce),this.init=function(){},this.dom_ready=function(){t("#respond_title").after('<div id="cpajax_error_msg"></div>'),t("#submit").after('<img src="'+e.cpajax_spinner_url+'" id="loading" alt="'+e.cpajax_lang[0]+'" />'),t("#loading").hide(),e.cpajax_form=t("#commentform"),e.cpajax_error=t("#cpajax_error_msg"),e.cpajax_error.hide(),e.initialise_form(),e.edit_comments_setup()},this.reset=function(){t("#loading").hide(),t("#submit").prop("disabled",!1),t("#submit").show(),addComment.enableForm(),e.cpajax_submitting=!1},this.add_comment=function(n){var a,i,o,r,m="";a=e.cpajax_form.find("#comment_parent").val(),i=t("ol.commentlist").first(),null!=n&&("0"!=a?(o="#li-comment-"+a,child_list=t(o+" > ol.children").first(),child_list[0]?(n.find(o+" > ol.children").first().children().last().clone().appendTo(child_list).hide(),list_item=t(o+" > ol.children").first().children().last(),list_item_id=t(o+" > ol.children").first().children().last().prop("id"),m=e.cleanup(list_item,list_item_id)):(n.find(o+" > ol.children").first().clone().appendTo(o).hide(),list_item=t(o+" > ol.children").first(),list_item_id=t(o+" > ol.children").first().children().last().prop("id"),m=e.cleanup(list_item,list_item_id))):i[0]?(n.find("ol.commentlist").first().children().last().clone().appendTo(i).hide(),list_item=t("ol.commentlist").first().children().last(),list_item_id=t("ol.commentlist").first().children().last().prop("id"),m=e.cleanup(list_item,list_item_id)):(n.find("ol.commentlist").first().clone().prependTo("div.comments_container").hide(),list_item=t("ol.commentlist").first(),list_item_id=t("ol.commentlist").first().children().last().prop("id"),m=e.cleanup(list_item,list_item_id))),r=n.find("#comments_in_page_wrapper div.comments_container > h3.general_comments_header"),t("#comments_in_page_wrapper div.comments_container > h3.general_comments_header").replaceWith(r),e.cpajax_form.find("#comment").val(""),e.edit_comments_setup(),cpajax_reenable_featured_comments(),cpajax_reenable_comment_upvoter(),t(document).trigger("commentpress-ajax-comment-added",[m])},this.cleanup=function(e,n){var a,i;return a="#comment-"+n.toString().split("-")[2],i=t(a),addComment.cancelForm(),i.addClass("comment-highlighted"),t(e).slideDown("slow",function(){t(window).stop(!0).scrollTo(i,{duration:cp_scroll_speed,axis:"y",offset:CommentPress.theme.header.get_offset(),onAfter:function(){i.addClass("comment-fade")}})}),a},this.initialise_form=function(){t("#commentform").off("submit"),t("#commentform").on("submit",function(n){if(e.cpajax_submitting=!0,e.cpajax_error.hide(),e.cpajax_form.find("#author")[0]){if(""==e.cpajax_form.find("#author").val())return e.cpajax_error.html('<span class="error">'+e.cpajax_lang[1]+"</span>"),e.cpajax_error.show(),n.preventDefault&&n.preventDefault(),e.cpajax_submitting=!1,!1;if(""==e.cpajax_form.find("#email").val())return e.cpajax_error.html('<span class="error">'+e.cpajax_lang[2]+"</span>"),e.cpajax_error.show(),n.preventDefault&&n.preventDefault(),e.cpajax_submitting=!1,!1;if(!/^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/.test(e.cpajax_form.find("#email").val()))return e.cpajax_error.html('<span class="error">'+e.cpajax_lang[3]+"</span>"),e.cpajax_error.show(),n.preventDefault&&n.preventDefault(),e.cpajax_submitting=!1,!1}return"1"==cp_tinymce&&(tinyMCE.triggerSave(),addComment.disableForm()),""==e.cpajax_form.find("#comment").val()?(e.cpajax_error.html('<span class="error">'+e.cpajax_lang[4]+"</span>"),e.cpajax_error.show(),n.preventDefault&&n.preventDefault(),addComment.enableForm(),e.cpajax_submitting=!1,!1):"y"==e.cpajax_form.find("#cp_edit_comment").val()?(n.preventDefault&&n.preventDefault(),e.edit_comment(t(this))):(t(this).ajaxSubmit({beforeSubmit:function(){t("#loading").show(),t("#submit").prop("disabled","disabled"),t("#submit").hide()},error:function(t){var n;return e.cpajax_error.empty(),n=t.responseText.match(/<p>(.*)<\/p>/),e.cpajax_error.html('<span class="error">'+n[1]+"</span>"),e.cpajax_error.show(),e.reset(),!1},success:function(n){var a;a=t.parseHTML?t(t.parseHTML(n)):t(n);try{e.add_comment(a),e.reset()}catch(t){e.reset(),alert(e.cpajax_lang[6]+"\n\n"+t)}}}),!1)})},this.edit_comments_setup=function(){t("#wrapper").off("click",".comment-edit-link"),t("#wrapper").on("click",".comment-edit-link",function(t){var n;t.preventDefault(),n=parseInt(this.href.split("c=")[1]),e.get_comment(n)})},this.get_comment=function(n){var a;e.cpajax_submitting||(e.cpajax_submitting=!0,a={action:"cpajax_get_comment",comment_id:n,_ajax_nonce:e.cpajax_nonce},t.post(e.cpajax_ajax_url,a,function(t,n){"success"==n?e.get_comment_callback(t):e.cpajax_submitting=!1},"json"))},this.get_comment_callback=function(n){addComment.moveFormToEdit("comment-"+n.id,n.id,"respond",n.post_id,n.text_sig,n.content,n.nonce),t(document).trigger("commentpress-ajax-comment-callback",[n]),e.cpajax_submitting=!1},this.edit_comment=function(n){return e.cpajax_submitting=!0,n.ajaxSubmit({url:e.cpajax_ajax_url,data:{action:"cpajax_edit_comment"},beforeSubmit:function(){t("#loading").show(),t("#submit").prop("disabled","disabled"),t("#submit").hide()},error:function(t){return e.reset(),console.log("edit_comment failed",t),!1},success:function(n){var a;n.id&&(t("#respond").slideUp("fast",function(){addComment.commentEditResetForm(),addComment.cancelForm(),t("#respond").show()}),(a=t("#comment-"+n.id)).addClass("comment-highlighted"),t("#comment-"+n.id+" .comment-content").html(n.content),t(document).trigger("commentpress-ajax-comment-edited",[n]),t("#comment-"+n.id+" .comment-content").slideDown("fast",function(){t(window).stop(!0).scrollTo(a,{duration:cp_scroll_speed,axis:"y",offset:CommentPress.theme.header.get_offset(),onAfter:function(){a.addClass("comment-fade")}})}),e.reset())}}),!1}},CommentPress.ajax.comments.init(),jQuery(document).ready(function(e){CommentPress.ajax.comments.dom_ready()});
