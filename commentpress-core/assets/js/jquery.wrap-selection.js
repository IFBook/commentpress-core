(function(a){a.fn.getRangeAt=function(){var e=this;var c=a.fn.range;c.ClearVariables();c.setRange();if(this[0]===document){}else{var d=a(c.startContainer).parents().index(e);var b=a(c.endContainer).parents().index(e);if(d===-1||b===-1){c.ClearVariables();return false}}return c};a.fn.wrapSelection=function(p){var i=a.fn.range;var h="sel_"+new Date().getTime();var d={fitToWord:true,wrapRange:false,selectClass:h,regexElementBlockers:new RegExp(/^BR$/),regexWordCharacterBasic:new RegExp(/^\S$/),regexWordCharacterFull:new RegExp(/^[A-Za-z0-9':,\-]$/),regexWordPunc:new RegExp(/^[:,]$/),regexWordNumbers:new RegExp(/^[0-9]$/)};var b=a.extend({},d,p);function f(r,q){if(q){a.fn.range=q}else{a(r).getRangeAt()}}function m(){var q=a.fn.range;var r=(q.startContainer===q.endContainer);if(q.startContainer.nodeType===3&&q.startOffset>0){var s=q.startContainer.splitText(q.startOffset);if(r){q.endContainer=s;q.endOffset=q.endOffset-q.startContainer.length}q.startContainer=s;q.startOffset=0}if(q.endContainer.nodeType===3&&q.endOffset<q.endContainer.length){q.endContainer.splitText(q.endOffset);q.endOffset=q.endContainer.length}}function l(r,q){if(q<0){var s=a.fn.wrapSelection.dom.GetPreviousTextNode(r);if(s){r=s;q=r.length}}if(q<r.length-1){return{container:r,offset:q+1,character:r.nodeValue.substr(q+1,1)}}else{var t=a.fn.wrapSelection.dom.GetNextTextNode(r,r.parentNode);if(!t){return{container:r,offset:q,character:""}}var u=a.fn.wrapSelection.dom.GetNextSiblingElement(r);while(u&&a.fn.compareDocumentPosition(t,u)&2){if(u.nodeName.match(b.regexElementBlockers)){return{container:r,offset:q,character:""}}u=a.fn.wrapSelection.dom.GetNextSiblingElement(u)}return{container:t,offset:0,character:t.nodeValue.substr(0,1)}}}function e(r,q){if(q>0){return{container:r,offset:q-1,character:r.nodeValue.substr(q-1,1)}}else{var t=a.fn.wrapSelection.dom.GetPreviousTextNode(r);if(!t){return{container:r,offset:q,character:""}}var s=a.fn.wrapSelection.dom.GetPreviousSiblingElement(r);while(s&&a.fn.compareDocumentPosition(t,s)&4){if(s.nodeName.match(b.regexElementBlockers)){return{container:r,offset:q,character:""}}s=a.fn.wrapSelection.dom.GetPreviousSiblingElement(s)}return{container:t,offset:t.length-1,character:t.nodeValue.substr(t.length-1,1)}}}function o(s,q,u){var t="";if(q>0){t=s.nodeValue.substr(q-1,1)}else{var r=e(s,q);if(b.regexWordCharacterFull.test(r.character)){t=s.nodeValue.substr(q,0,1);q=1}}if(b.regexWordCharacterBasic.test(t)){if(u==="normal"){var v=l(s,q-1);if(b.regexWordCharacterFull.test(v.character)){return o(v.container,v.offset+1,"normal")}}return{container:s,offset:q}}else{if(u==="normal"&&b.regexWordPunc.test(t)){var v=l(s,q);if(b.regexWordNumbers.test(v.character)){return o(v.container,v.offset,"normal")}else{return{container:s,offset:q-1}}}}var r=e(s,q-1);if(r.character.length===1){return o(r.container,r.offset+1,"reverse")}else{return{container:s,offset:q}}}function g(r,q,u){var s=r.nodeValue.substr(q,1);if(b.regexWordCharacterBasic.test(s)){if(u==="normal"){var v=e(r,q);if(b.regexWordCharacterFull.test(v.character)){return g(v.container,v.offset,"normal")}}return{container:r,offset:q}}else{if(u==="normal"&&b.regexWordPunc.test(s)){var v=e(r,q);if(b.regexWordNumbers.test(v.character)){return g(v.container,v.offset,"normal")}}}var t=l(r,q);if(t.character.length===1){return g(t.container,t.offset,"reverse")}else{return{container:r,offset:q}}}function n(){var r=a.fn.range;var s=g(r.startContainer,r.startOffset,"normal");var q=o(r.endContainer,r.endOffset,"normal");r.startContainer=s.container;r.startOffset=s.offset;r.endContainer=q.container;r.endOffset=q.offset}function j(){var x=a.fn.range;var w=[];if(!x.startContainer||!x.endContainer){return false}var v=x.GetContainedNodes();var t=v.length;var q=0;for(var s=0;s<t;s++){if(!v[s][0]){continue}for(var r=0,u=v[s].length;r<u;r++){a(v[s][r]).find("*").add(a(v[s][r])).contents().add(a(v[s][r])).filter(function(){if(this.nodeType!==3){return false}return a.trim(this.textContent).length>0}).wrap(c());q+=1}}return q}function c(){var q=document.createElement("span");q.className=b.selectClass;return q}f(this,b.wrapRange);if(i.startContainer&&i.endContainer){if(b.fitToWord){n()}m();var k=j();if(k){i.ClearAllRanges()}else{i.ClearVariables()}return a("."+b.selectClass)}else{return a([])}};a.fn.range={onlySpacesMatch:new RegExp(/[^\t\r\n ]/),containedNodes:null,selection:null,commonAncestorContainer:null,startContainer:null,startOffset:null,endContainer:null,endOffset:null,collapsed:true,setRange:function(){if(window.getSelection){this.selection=window.getSelection()}else{if(document.selection){this.selection=document.selection.createRange()}}if(this.selection.getRangeAt){var b=this.selection.getRangeAt(0)}else{var b=document.createRange();b.setStart(this.selection.anchorNode,this.selection.anchorOffset);b.setEnd(this.selection.focusNode,this.selection.focusOffset)}if(!b.toString().match(this.onlySpacesMatch)){return false}this.startContainer=b.startContainer;this.startOffset=b.startOffset;this.endContainer=b.endContainer;this.endOffset=b.endOffset;this.collapsed=b.collapsed},ClearAllRanges:function(){if(!a.fn.range.selection){return}a.fn.range.selection.removeAllRanges();a.fn.range.ClearVariables()},ClearVariables:function(){this.selection=null;this.commonAncestorContainer=null;this.containedNodes=null;this.startContainer=null;this.startOffset=null;this.endContainer=null;this.endOffset=null;this.collapsed=true},GetContainedNodes:function(){return this.doGetContainedNodes()},doGetContainedNodes:function(){if(this.containedNodes){return this.containedNodes}if(!this.startContainer||!this.endContainer){return[]}var g=this.startContainer;var b=this.endContainer;var h=new Array([]);var d=g;var f=a.fn.compareDocumentPosition(g,b);var e=d.parentNode;var c=0;while((f&4)||f===0){if(f&16){d=d.firstChild}else{if(e!==d.parentNode){c++;h[c]=[];e=d.parentNode}h[c].push(d);d=a.fn.wrapSelection.dom.GetNextSiblingOrParent(d);if(f===0){break}}f=a.fn.compareDocumentPosition(d,b)}this.containedNodes=h;return h}};a.fn.wrapSelection.dom={GetNextSiblingElement:function(b){return a.fn.wrapSelection.dom.getElementOrder(b,"next")},GetNextSiblingOrParent:function(b){return a.fn.wrapSelection.dom.getSiblingOrParentOrder(b,"next")},GetNextTextNode:function(b,c){while(b=a.fn.wrapSelection.dom.getNodeOrder(b,c,"next")){if(b.nodeType===3){return b}}return b},GetPreviousSiblingElement:function(b){return this.getElementOrder(b,"previous")},GetPreviousTextNode:function(b,c){while(b=a.fn.wrapSelection.dom.getNodeOrder(b,c,"previous")){if(b.nodeType===3){return b}}return b},getElementOrder:function(c,b){b+="Sibling";while(c[b]&&c[b].nodeType!==1){c=c[b]}return c[b]},getSiblingOrParentOrder:function(c,d){var b=d+"Sibling";if(c[b]){return c[b]}else{if(c.parentNode){return this.getSiblingOrParentOrder(c.parentNode,d)}else{return null}}},getNodeOrder:function(c,d,e){if(typeof d==="undefined"){d=document.body}if(c.hasChildNodes()){return(e==="next")?c.firstChild:c.lastChild}if(c===d){return null}var b=(e==="next")?"nextSibling":"previousSibling";if(c[b]){return c[b]}while(c=c.parentNode){if(c===d){return null}if(c[b]){return c[b]}}return null}};if(msie_detected){a.extend(a.fn.range,{ClearAllRanges:function(){if(this.selection){this.selection.empty()}this.ClearVariables()},setRange:function(){this.selection=document.selection;var f=this.selection.createRange();var e=f.text;if(!e.length){return false}if(!e.match(this.onlySpacesMatch)){return false}var c=this.getInitialContainer(f.duplicate(),"start");var d=a.fn.wrapSelection.dom.SourceIndex(c.container,"string");var b=this.getInitialContainer(f.duplicate(),"end");if(d===a.fn.wrapSelection.dom.SourceIndex(b.container,"string")){c.container=b.container}this.startContainer=c.container;this.startOffset=c.offset;this.endContainer=b.container;this.endOffset=b.offset;this.collapsed=(c.container===b.container&&c.offset===b.offset);f.select();return true},getInitialContainer:function(h,d){if(d==="start"){h.collapse(true)}else{h.collapse(false)}var g=h.parentElement();h.pasteHTML('<span id="range-temp"></span>');var c=a("#range-temp")[0];var b=0;var f=a.fn.wrapSelection.dom.GetNextTextNode(c,c.parentNode);if(!f){f=a.fn.wrapSelection.dom.GetPreviousTextNode(c,c.parentNode);b=f.length}c.parentNode.removeChild(c);if(d==="start"){if(f.previousSibling&&f.previousSibling.nodeType===3){var e=g.removeChild(f.previousSibling);b+=e.length;f.insertData(0,e.nodeValue)}}else{if(f.previousSibling&&f.previousSibling.nodeType===3){var e=f.previousSibling;b+=e.length;g.removeChild(f);e.appendData(f.nodeValue);f=e}}return{container:f,offset:b}}});a.extend(a.fn.wrapSelection.dom,{SourceIndex:function(e,d){var c=[];do{var b=0;while(e.previousSibling){e=e.previousSibling;b++}c.unshift(b)}while(e=e.parentNode);if(d&&d==="string"){return c.join(".")}return c}})}a.fn.compareDocumentPosition=function(c,b){function f(h){var g;do{g=h}while(h=h.parentNode);return g}if("compareDocumentPosition" in document.documentElement){a.fn.compareDocumentPosition=function(h,g){return h.compareDocumentPosition(g)}}else{if("sourceIndex" in document.documentElement&&"contains" in document.documentElement){a.fn.compareDocumentPosition=function(l,j){function h(o,n){return(o.contains(n)&&16)+(n.contains(o)&&8)+(o.sourceIndex>=0&&n.sourceIndex>=0?(o.sourceIndex<n.sourceIndex&&4)+(o.sourceIndex>n.sourceIndex&&2):1)}function m(n){if("sourceIndex" in n){return n}return n.parentNode.insertBefore(document.createComment(""),n)}if(l===j){return 0}if(f(l)!==f(j)){return 1}if("sourceIndex" in l&&"sourceIndex" in j){return h(l,j)}if(l===document){return 20}else{if(j===document){return 10}}var k=m(l),i=m(j);var g=h(k,i);if(l!==k){k.parentNode.removeChild(k)}if(j!==i){i.parentNode.removeChild(i)}return g}}else{function e(j,h){if(j.length===h.length){return(j<h)?4:2}else{if(j.length<h.length){var i=h.substr(0,j.length);if(j===i){return 20}return e(j,i)}else{var g=e(h,j);return(g&4)?g>>1:g<<1}}}function d(i){var h=[];do{var l=0,g=i;while(g=g.previousSibling){l++}var k=i.parentNode.childNodes.length.toString().length;var j=l.toString().length;if(k>j){for(;j<=k;j++){l="0"+l}}h.unshift(l)}while((i=i.parentNode)&&i!==document);return h.join(".")}a.fn.compareDocumentPosition=function(h,g){if(h===g){return 0}if(f(h)!==f(g)){return 1}if(h===document||("contains" in h&&"contains" in g&&h.contains(g))){return 20}else{if(g===document||("contains" in h&&"contains" in g&&g.contains(h))){return 10}}return e(d(h),d(g))}}}return a.fn.compareDocumentPosition(c,b)}})(jQuery);