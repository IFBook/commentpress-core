var msie_detected=false;if("undefined"!==typeof cp_msie){msie_detected=true}msie6_detected=false;if("undefined"!==typeof cp_msie6){msie6_detected=true}if("undefined"!==typeof CommentpressSettings){var cp_wp_adminbar,cp_wp_adminbar_height,cp_wp_adminbar_expanded,cp_bp_adminbar,cp_comments_open,cp_special_page,cp_tinymce,cp_tinymce_version,cp_promote_reading,cp_is_mobile,cp_is_touch,cp_is_tablet,cp_cookie_path,cp_multipage_page,cp_template_dir,cp_plugin_dir,cp_toc_chapter_is_page,cp_show_subpages,cp_default_sidebar,cp_is_signup_page,cp_scroll_speed,cp_min_page_width,cp_textblock_meta;cp_wp_adminbar=CommentpressSettings.cp_wp_adminbar;cp_wp_adminbar_height=parseInt(CommentpressSettings.cp_wp_adminbar_height);cp_wp_adminbar_expanded=parseInt(CommentpressSettings.cp_wp_adminbar_expanded);cp_bp_adminbar=CommentpressSettings.cp_bp_adminbar;cp_comments_open=CommentpressSettings.cp_comments_open;cp_special_page=CommentpressSettings.cp_special_page;cp_tinymce=CommentpressSettings.cp_tinymce;cp_tinymce_version=CommentpressSettings.cp_tinymce_version;cp_promote_reading=CommentpressSettings.cp_promote_reading;cp_is_mobile=CommentpressSettings.cp_is_mobile;cp_is_touch=CommentpressSettings.cp_is_touch;cp_is_tablet=CommentpressSettings.cp_is_tablet;cp_cookie_path=CommentpressSettings.cp_cookie_path;cp_multipage_page=CommentpressSettings.cp_multipage_page;cp_template_dir=CommentpressSettings.cp_template_dir;cp_plugin_dir=CommentpressSettings.cp_plugin_dir;cp_toc_chapter_is_page=CommentpressSettings.cp_toc_chapter_is_page;cp_show_subpages=CommentpressSettings.cp_show_subpages;cp_default_sidebar=CommentpressSettings.cp_default_sidebar;cp_is_signup_page=CommentpressSettings.cp_is_signup_page;cp_scroll_speed=CommentpressSettings.cp_js_scroll_speed;cp_min_page_width=CommentpressSettings.cp_min_page_width;cp_textblock_meta=CommentpressSettings.cp_textblock_meta}var CommentPress=CommentPress||{};CommentPress.settings={};CommentPress.settings.textblock=new function(){this.marker_mode="marker";this.setMarkerMode=function(a){this.marker_mode=a},this.getMarkerMode=function(){return this.marker_mode}};(function($){var highlighted_para="";$.highlight_para=function(element){if(typeof(element)!="object"){return}element.addClass("selected_para")};$.unhighlight_para=function(){var highlighted_paras=$(".textblock");highlighted_paras.removeClass("selected_para")};$.get_highlighted_para=function(){return highlighted_para};$.is_highlighted=function(element){if(typeof(element)!="object"){return false}if(element.hasClass("selected_para")){return true}else{return false}};$.set_sidebar_height=function(){var sidebar=$("#sidebar");var sidebar_inner=$("#sidebar_inner");var sidebar_container=$("#toc_sidebar");var header=$("#"+$.get_sidebar_name()+"_sidebar .sidebar_header");var minimiser=$.get_sidebar_pane();var s_top=sidebar.offset().top;var sidebar_inside_h=$.get_element_adjust(sidebar);var sidebar_inner_inside_h=$.get_element_adjust(sidebar_inner);var sidebar_diff=s_top+sidebar_inside_h+sidebar_inner_inside_h;var sc_top=sidebar_container.position().top;var sc_inside_h=$.get_element_adjust(sidebar_container);var sc_diff=sc_top+sc_inside_h;var header_diff=0;if(header.css("display")!="none"){header_diff=header.height()+$.get_element_adjust(header)}var minimiser_diff=$.get_element_adjust(minimiser);if(cp_is_signup_page=="1"){var bottom_margin=$.css_to_num($.px_to_num($("#content").css("margin-bottom")))}else{var bottom_margin=$.css_to_num($.px_to_num($("#page_wrapper").css("margin-bottom")))}var viewport_height=$(window).height();var viewport_scrolltop=$(window).scrollTop();var viewport=viewport_height+viewport_scrolltop;var to_bottom=viewport-(sidebar_diff+sc_diff+header_diff+minimiser_diff+bottom_margin);$("#sidebar div.sidebar_contents_wrapper").css("height",to_bottom+"px");return to_bottom};$.get_element_adjust=function(element){var w_bt=$.css_to_num($.px_to_num(element.css("borderTopWidth")));var w_bb=$.css_to_num($.px_to_num(element.css("borderBottomWidth")));var w_pad_t=$.css_to_num($.px_to_num(element.css("padding-top")));var w_pad_b=$.css_to_num($.px_to_num(element.css("padding-bottom")));var w_mar_t=$.css_to_num($.px_to_num(element.css("margin-top")));var w_mar_b=$.css_to_num($.px_to_num(element.css("margin-bottom")));var element_adjust=w_bt+w_bb+w_pad_t+w_pad_b+w_mar_t+w_mar_b;return element_adjust};$.get_sidebar_pane=function(){var name=$.get_sidebar_name();return $("#"+name+"_sidebar .sidebar_minimiser")};$.get_sidebar_name=function(){var name="toc";if(cp_default_sidebar=="comments"){name="comments";if(cp_toc_on_top=="y"){name="toc"}}if(cp_default_sidebar=="activity"){name="activity";if(cp_toc_on_top=="y"){name="toc"}}return name};$.get_current_menu_item_id=function(){var current_menu_item=0,current_menu_obj,current_item_id,current_item_classes,current_item_class;current_menu_obj=$(".current_page_item");if(current_menu_obj.length>0){current_item_id=current_menu_obj.prop("id");if(current_item_id.length>0){current_menu_item=current_item_id.split("-")[2]}else{current_item_class=current_menu_obj.prop("class");current_item_classes=current_item_class.split(" ");for(var i=0,item;item=current_item_classes[i++];){if(item.match("page-item-")){current_menu_item=item.split("-")[2];break}}}}return current_menu_item};$.in_array=function(needle,haystack,argStrict){var found=false,key,strict=!!argStrict;for(key in haystack){if((strict&&haystack[key]===needle)||(!strict&&haystack[key]==needle)){found=true;break}}return found};$.remove_from_array=function(item,sourceArray){for(var i=0;i<sourceArray.length;i++){if(item===sourceArray[i]){sourceArray.splice(i,1);break}}return sourceArray};$.is_object=function(mixed_var){if(mixed_var instanceof Array){return false}else{return(mixed_var!==null)&&(typeof(mixed_var)=="object")}};$.is_function_defined=function(function_name){if(eval("typeof("+function_name+") == typeof(Function)")){return true}return false};$.px_to_num=function(pix){return parseInt(pix.substring(0,(pix.length-2)))};$.css_to_num=function(strNum){if(strNum&&strNum!=""){var i=parseFloat(strNum);if(i.toString()=="NaN"){return 0}else{return i}}return 0};$.frivolous=function(message){alert(message)};$.on_load_scroll_to_comment=function(){var url,comment_id,comment;url=document.location.toString();if(url.match("#comment-")){comment_id=url.split("#comment-")[1];comment=$("#comment-"+comment_id);if(comment.length){if(msie6_detected){$("#main_wrapper").scrollTo(comment,{duration:cp_scroll_speed,axis:"y",offset:commentpress_get_header_offset()})}else{if(cp_is_mobile=="0"||cp_is_tablet=="1"){$.scrollTo(comment,{duration:cp_scroll_speed,axis:"y",offset:commentpress_get_header_offset()})}}}}};$.setup_title_actions=function(){$(".post_title a").unbind("click");$(".post_title a").click(function(event){event.preventDefault();var text_sig="";cp_do_comment_icon_action(text_sig,"marker");return false})};$.setup_textblock_actions=function(){if(cp_is_mobile=="0"){if(cp_textblock_meta=="0"){$(".textblock").mouseover(function(){$(this).addClass("textblock-in")});$(".textblock").mouseout(function(){$(this).removeClass("textblock-in")})}}$(".textblock").unbind("click");$(".textblock").click(function(event){var text_sig;text_sig=$(this).prop("id");text_sig=text_sig.split("textblock-")[1];cp_do_comment_icon_action(text_sig,CommentPress.settings.textblock.getMarkerMode())})};$.setup_para_marker_actions=function(){$("span.para_marker a").unbind("click");$("span.para_marker a").click(function(event){event.preventDefault();var text_sig;text_sig=$(this).prop("href").split("#")[1];cp_do_comment_icon_action(text_sig,"marker");return false});$("span.para_marker a").unbind("mouseenter");$("span.para_marker a").unbind("mouseleave");$("span.para_marker a").mouseenter(function(event){var target;target=$(this).parent().next().children(".comment_count");target.addClass("js-hover")});$("span.para_marker a").mouseleave(function(event){var target;target=$(this).parent().next().children(".comment_count");target.removeClass("js-hover")})};$.setup_comment_permalink_copy_actions=function(){$(".comment_permalink_copy").unbind("mouseup");$(".comment_permalink_copy").mouseup(function(event){var url;url=$(this).parent().attr("href");if(url){window.prompt("Copy this link, then paste into where you need it",url)}})};$.setup_para_links=function(){$("a.cp_para_link").unbind("click");$("a.cp_para_link").click(function(event){var text_sig;event.preventDefault();text_sig=$(this).prop("href").split("#")[1];cp_do_comment_icon_action(text_sig,"auto");return false})};$.setup_textblock_comment_icons=function(){$("a.para_permalink").unbind("click");$("a.para_permalink").click(function(event){var text_sig;event.preventDefault();text_sig=$(this).prop("href").split("#")[1];cp_do_comment_icon_action(text_sig,"auto");return false});$("a.para_permalink").unbind("mouseenter");$("a.para_permalink").unbind("mouseleave");$("a.para_permalink").mouseenter(function(event){var text_sig;text_sig=$(this).prop("href").split("#")[1];$("span.para_marker a#"+text_sig).addClass("js-hover")});$("a.para_permalink").mouseleave(function(event){var text_sig;text_sig=$(this).prop("href").split("#")[1];$("span.para_marker a#"+text_sig).removeClass("js-hover")})};$.setup_context_headers=function(){$("h3.activity_heading").unbind("click");$("h3.activity_heading").css("cursor","pointer");$("h3.activity_heading").click(function(event){var para_wrapper;event.preventDefault();para_wrapper=$(this).next("div.paragraph_wrapper");para_wrapper.css("width",$(this).parent().css("width"));para_wrapper.slideToggle("slow",function(){para_wrapper.css("width","auto")});return false})};$.enable_context_clicks=function(){if(cp_special_page=="1"){return}$("a.comment_on_post").unbind("click");$("a.comment_on_post").click(function(event){var comment_id,comment,para_wrapper_array,item,header_offset,text_sig;event.preventDefault();cp_activate_sidebar("comments");comment_id=this.href.split("#")[1];comment=$("#"+comment_id);para_wrapper_array=comment.parents("div.paragraph_wrapper").map(function(){return this});if(para_wrapper_array.length>0){item=$(para_wrapper_array[0]);item.show();if(cp_special_page=="1"){header_offset=commentpress_get_header_offset();$.scrollTo(comment,{duration:cp_scroll_speed,axis:"y",offset:header_offset})}else{$.unhighlight_para();text_sig=item.prop("id").split("-")[1];commentpress_scroll_page_to_textblock(text_sig);$("#comments_sidebar .sidebar_contents_wrapper").scrollTo(comment,{duration:cp_scroll_speed,axis:"y",onAfter:function(){cp_flash_comment_header(comment)}})}}return false})};$.setup_comment_headers=function(){if(cp_special_page=="1"){return}$("a.comment_block_permalink").unbind("click");$("a.comment_block_permalink").css("cursor","pointer");$("a.comment_block_permalink").click(function(event){var text_sig,para_wrapper,comment_list,opening,visible,textblock,post_id,para_id,para_num,has_form;event.preventDefault();text_sig=$(this).parent().prop("id").split("para_heading-")[1];para_wrapper=$(this).parent().next("div.paragraph_wrapper");comment_list=$("#para_wrapper-"+text_sig).find("ol.commentlist");opening=false;visible=para_wrapper.css("display");if(visible=="none"){opening=true}if("undefined"!==typeof text_sig){if(text_sig!==""&&text_sig!="pingbacksandtrackbacks"){textblock=$("#textblock-"+text_sig);if(opening){$.unhighlight_para();$.highlight_para(textblock);commentpress_scroll_page(textblock)}else{if(cp_promote_reading=="0"){if($("#para_wrapper-"+text_sig).find("#respond")[0]){$.unhighlight_para()}else{if(!comment_list[0]){$.unhighlight_para();$.highlight_para(textblock);commentpress_scroll_page(textblock)}}}else{if($.is_highlighted(textblock)){$.unhighlight_para()}}}}else{$.unhighlight_para();if(text_sig!="pingbacksandtrackbacks"){commentpress_scroll_to_top(0,cp_scroll_speed);page_highlight=!page_highlight}}}if(cp_promote_reading=="0"&&text_sig!="pingbacksandtrackbacks"){if(cp_comments_open=="y"){post_id=$("#comment_post_ID").prop("value");para_id=$("#para_wrapper-"+text_sig+" .reply_to_para").prop("id");para_num=para_id.split("-")[1];has_form=$("#para_wrapper-"+text_sig).find("#respond")[0];if(comment_list.length>0&&comment_list[0]){if(!opening&&!has_form){}else{addComment.moveFormToPara(para_num,text_sig,post_id)}}else{if(!has_form){para_wrapper.css("display","none");opening=true}addComment.moveFormToPara(para_num,text_sig,post_id)}}}para_wrapper.slideToggle("slow",function(){if(opening){cp_scroll_comments($("#para_heading-"+text_sig),cp_scroll_speed)}});return false})};$.enable_comment_permalink_clicks=function(){$("a.comment_permalink").unbind("click");$("a.comment_permalink").click(function(event){var comment_id,header_offset,text_sig;event.preventDefault();comment_id=this.href.split("#")[1];if(cp_special_page=="1"){header_offset=commentpress_get_header_offset();$.scrollTo($("#"+comment_id),{duration:cp_scroll_speed,axis:"y",offset:header_offset})}else{$.unhighlight_para();text_sig=cp_get_text_sig_by_comment_id("#"+comment_id);if(text_sig!="pingbacksandtrackbacks"){commentpress_scroll_page_to_textblock(text_sig)}cp_scroll_comments($("#"+comment_id),cp_scroll_speed)}return false})};$.reset_comment_actions=function(){$(".comment-wrapper").unbind("mouseenter");$(".comment-wrapper").unbind("mouseleave");$(".comment-wrapper").mouseenter(function(event){$(this).addClass("background-highlight")});$(".comment-wrapper").mouseleave(function(event){$(this).removeClass("background-highlight")})};$.highlight_comment=function(comment){comment.addClass("notransition");if(comment.hasClass("comment-fade")){comment.removeClass("comment-fade")}if(comment.hasClass("comment-highlighted")){comment.removeClass("comment-highlighted")}comment.addClass("comment-highlighted");comment.removeClass("notransition");comment.height();comment.addClass("comment-fade")};$.get_text_sig_by_comment_id=function(cid){var comment_id,para_wrapper_array,text_sig,item;text_sig="";if(cid.match("#comment-")){comment_id=parseInt(cid.split("#comment-")[1])}para_wrapper_array=$("#comment-"+comment_id).parents("div.paragraph_wrapper").map(function(){return this});if(para_wrapper_array.length>0){item=$(para_wrapper_array[0]);text_sig=item.prop("id").split("-")[1]}return text_sig};$.scroll_comments=function(target,speed,flash){switch(arguments.length){case 2:flash="noflash";break;case 3:break;default:throw new Error("illegal argument count")}if(cp_is_mobile=="0"||cp_is_tablet=="1"){if(flash=="flash"){$("#comments_sidebar .sidebar_contents_wrapper").scrollTo(target,{duration:speed,axis:"y",onAfter:function(){cp_flash_comment_header(target);$(document).trigger("commentpress-comments-scrolled")}})}else{$("#comments_sidebar .sidebar_contents_wrapper").scrollTo(target,{duration:speed,onAfter:function(){$(document).trigger("commentpress-comments-scrolled")}})}}};$.scroll_page=function(target){if(typeof target==="undefined"){return}if(msie6_detected){$(window).scrollTo(0,0);$("#main_wrapper").scrollTo(target,{duration:(cp_scroll_speed*1.5),axis:"y",offset:commentpress_get_header_offset()},function(){$(window).scrollTo(0,1)})}else{if(cp_is_mobile=="0"||cp_is_tablet=="1"){$.scrollTo(target,{duration:(cp_scroll_speed*1.5),axis:"y",offset:commentpress_get_header_offset()})}}};$.quick_scroll_page=function(target,duration){if(typeof target==="undefined"){return}if(msie6_detected){$(window).scrollTo(0,0);$("#main_wrapper").scrollTo(target,{duration:(duration*1.5),axis:"y",offset:commentpress_get_header_offset()},function(){$(window).scrollTo(0,1)})}else{if(cp_is_mobile=="0"||cp_is_tablet=="1"){$.scrollTo(target,{duration:(duration*1.5),axis:"y",offset:commentpress_get_header_offset()})}}};$.scroll_page_to_textblock=function(text_sig){var textblock;if(text_sig!==""){textblock=$("#textblock-"+text_sig);$.highlight_para(textblock);commentpress_scroll_page(textblock)}else{if(page_highlight===false){commentpress_scroll_to_top(0,cp_scroll_speed)}page_highlight=!page_highlight}};$.footnotes_compatibility=function(){$("span.footnotereverse a, a.footnote-back-link").unbind("click");$("span.footnotereverse a, a.footnote-back-link").click(function(event){var target;event.preventDefault();target=$(this).prop("href").split("#")[1];cp_quick_scroll_page("#"+target,100);return false});$(".simple-footnotes ol li > a").unbind("click");$(".simple-footnotes ol li > a").click(function(event){var target;target=$(this).prop("href");if(target.match("#return-note-")){event.preventDefault();target=target.split("#")[1];cp_quick_scroll_page("#"+target,100);return false}});$("a.simple-footnote, sup.footnote a, sup a.footnote-identifier-link, a.zp-ZotpressInText").unbind("click");$("a.simple-footnote, sup.footnote a, sup a.footnote-identifier-link, a.zp-ZotpressInText").click(function(event){var target;event.preventDefault();target=$(this).prop("href").split("#")[1];cp_quick_scroll_page("#"+target,100);return false})}})(jQuery);function commentpress_scroll_page(a){jQuery.scroll_page(a)}function cp_quick_scroll_page(b,a){jQuery.quick_scroll_page(b,a)}function cp_flash_comment_header(a){jQuery.highlight_comment(a)}function cp_scroll_comments(c,b,a){jQuery.scroll_comments(c,b,a)}function cp_get_text_sig_by_comment_id(a){return jQuery.get_text_sig_by_comment_id(a)}function commentpress_scroll_page_to_textblock(a){jQuery.scroll_page_to_textblock(a)}function commentpress_enable_comment_permalink_clicks(){jQuery.enable_comment_permalink_clicks()}function commentpress_setup_context_headers(){jQuery.setup_context_headers()}function cp_enable_context_clicks(){jQuery.enable_context_clicks()}function cp_scroll_to_comment_on_load(){jQuery.on_load_scroll_to_comment()}function commentpress_setup_para_permalink_icons(){jQuery.setup_textblock_comment_icons()}function commentpress_setup_title_actions(){jQuery.setup_title_actions()}function commentpress_setup_textblock_actions(){jQuery.setup_textblock_actions()}function commentpress_setup_para_marker_actions(){jQuery.setup_para_marker_actions()}function commentpress_setup_comment_permalink_copy_actions(){jQuery.setup_comment_permalink_copy_actions()}function commentpress_setup_page_click_actions(){commentpress_setup_title_actions();commentpress_setup_textblock_actions();commentpress_setup_para_marker_actions();commentpress_setup_comment_permalink_copy_actions()}function commentpress_setup_para_links(){jQuery.setup_para_links()}function commentpress_setup_footnotes_compatibility(){jQuery.footnotes_compatibility()}function commentpress_reset_actions(){commentpress_setup_comment_headers();commentpress_enable_comment_permalink_clicks();commentpress_setup_para_permalink_icons();commentpress_setup_page_click_actions();commentpress_setup_para_links();cp_enable_context_clicks();commentpress_setup_context_headers();commentpress_setup_footnotes_compatibility();jQuery(document).trigger("commentpress-reset-actions")};