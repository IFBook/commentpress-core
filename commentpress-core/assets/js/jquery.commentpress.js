var msie_detected=false;if("undefined"!==typeof cp_msie){msie_detected=true}if("undefined"!==typeof CommentpressSettings){var cp_wp_adminbar,cp_wp_adminbar_height,cp_wp_adminbar_expanded,cp_bp_adminbar,cp_comments_open,cp_special_page,cp_tinymce,cp_tinymce_version,cp_promote_reading,cp_is_mobile,cp_is_touch,cp_is_tablet,cp_cookie_path,cp_multipage_page,cp_template_dir,cp_plugin_dir,cp_toc_chapter_is_page,cp_show_subpages,cp_default_sidebar,cp_is_signup_page,cp_scroll_speed,cp_min_page_width,cp_textblock_meta;cp_wp_adminbar=CommentpressSettings.cp_wp_adminbar;cp_wp_adminbar_height=parseInt(CommentpressSettings.cp_wp_adminbar_height);cp_wp_adminbar_expanded=parseInt(CommentpressSettings.cp_wp_adminbar_expanded);cp_bp_adminbar=CommentpressSettings.cp_bp_adminbar;cp_comments_open=CommentpressSettings.cp_comments_open;cp_special_page=CommentpressSettings.cp_special_page;cp_tinymce=CommentpressSettings.cp_tinymce;cp_tinymce_version=CommentpressSettings.cp_tinymce_version;cp_promote_reading=CommentpressSettings.cp_promote_reading;cp_is_mobile=CommentpressSettings.cp_is_mobile;cp_is_touch=CommentpressSettings.cp_is_touch;cp_is_tablet=CommentpressSettings.cp_is_tablet;cp_cookie_path=CommentpressSettings.cp_cookie_path;cp_multipage_page=CommentpressSettings.cp_multipage_page;cp_template_dir=CommentpressSettings.cp_template_dir;cp_plugin_dir=CommentpressSettings.cp_plugin_dir;cp_toc_chapter_is_page=CommentpressSettings.cp_toc_chapter_is_page;cp_show_subpages=CommentpressSettings.cp_show_subpages;cp_default_sidebar=CommentpressSettings.cp_default_sidebar;cp_is_signup_page=CommentpressSettings.cp_is_signup_page;cp_scroll_speed=CommentpressSettings.cp_js_scroll_speed;cp_min_page_width=CommentpressSettings.cp_min_page_width;cp_textblock_meta=CommentpressSettings.cp_textblock_meta}var CommentPress=CommentPress||{};CommentPress.settings={};CommentPress.settings.textblock=new function(){this.marker_mode="marker";this.setMarkerMode=function(a){this.marker_mode=a};this.getMarkerMode=function(){return this.marker_mode}};CommentPress.setup={};CommentPress.setup.navigation=new function(){var a=this;this.init=function(){a.headings();a.menu()};this.headings=function(){jQuery("h3.activity_heading").css("cursor","pointer");jQuery("#toc_sidebar").on("click","h3.activity_heading",function(c){var b;c.preventDefault();b=jQuery(this).next("div.paragraph_wrapper");b.css("width",jQuery(this).parent().css("width"));b.slideToggle("slow",function(){b.css("width","auto")})})};this.menu=function(){jQuery("#toc_sidebar").on("click","ul#toc_list li a",function(c){if(cp_toc_chapter_is_page=="0"){var b;b=$(this).parent().find("ul");if(b.length>0){if(cp_show_subpages=="0"){$(this).next("ul").slideToggle()}c.preventDefault()}}})}};CommentPress.setup.content=new function(){var a=this;this.init=function(){a.title_links();a.textblocks();a.para_markers();a.comment_icons();a.links_in_textblocks();a.footnotes_compatibility()};this.title_links=function(){jQuery("#container").on("click",".post_title a",function(c){c.preventDefault();var b="";CommentPress.theme.viewport.align_content(b,"marker")})};this.textblocks=function(){if(cp_is_mobile=="0"){if(cp_textblock_meta=="0"){jQuery("#container").on("mouseover",".textblock",function(b){jQuery(this).addClass("textblock-in")});jQuery("#container").on("mouseout",".textblock",function(b){jQuery(this).removeClass("textblock-in")})}}jQuery("#container").on("click",".textblock",function(c){var b;b=jQuery(this).prop("id");b=b.split("textblock-")[1];CommentPress.theme.viewport.align_content(b,CommentPress.settings.textblock.getMarkerMode());jQuery(document).trigger("commentpress-textblock-clicked")})};this.para_markers=function(){jQuery("#container").on("click","span.para_marker a",function(b){b.preventDefault();jQuery(document).trigger("commentpress-paramarker-clicked")});jQuery("#container").on("mouseenter","span.para_marker a",function(b){var c;c=jQuery(this).parent().next().children(".comment_count");c.addClass("js-hover")});jQuery("#container").on("mouseleave","span.para_marker a",function(b){var c;c=jQuery(this).parent().next().children(".comment_count");c.removeClass("js-hover")})};this.comment_icons=function(){jQuery("#container").on("click",".commenticonbox",function(c){var b;c.preventDefault();c.stopPropagation();b=jQuery(this).children("a.para_permalink").prop("href").split("#")[1];CommentPress.theme.viewport.align_content(b,"auto");jQuery(document).trigger("commentpress-commenticonbox-clicked")});jQuery("#container").on("click","a.para_permalink",function(b){b.preventDefault()});jQuery("#container").on("mouseenter","a.para_permalink",function(c){var b;b=jQuery(this).prop("href").split("#")[1];jQuery("span.para_marker a#"+b).addClass("js-hover")});jQuery("#container").on("mouseleave","a.para_permalink",function(c){var b;b=jQuery(this).prop("href").split("#")[1];jQuery("span.para_marker a#"+b).removeClass("js-hover")})};this.links_in_textblocks=function(){jQuery("#container").on("click","a.cp_para_link",function(c){var b;c.preventDefault();b=jQuery(this).prop("href").split("#")[1];CommentPress.theme.viewport.align_content(b,"auto")})};this.footnotes_compatibility=function(){jQuery("#container").on("click","span.footnotereverse a, a.footnote-back-link",function(b){var c;b.preventDefault();c=jQuery(this).prop("href").split("#")[1];jQuery.quick_scroll_page("#"+c,100)});jQuery("#container").on("click",".simple-footnotes ol li > a",function(b){var c;c=jQuery(this).prop("href");if(c.match("#return-note-")){b.preventDefault();c=c.split("#")[1];jQuery.quick_scroll_page("#"+c,100)}});jQuery("#container").on("click","a.simple-footnote, sup.footnote a, sup a.footnote-identifier-link, a.zp-ZotpressInText",function(b){var c;b.preventDefault();c=jQuery(this).prop("href").split("#")[1];jQuery.quick_scroll_page("#"+c,100)})};this.workflow_tabs=function(c,b){jQuery("#literal .post").css("display","none");jQuery("#original .post").css("display","none");jQuery("#container").on("click","content-tabs li h2 a",function(e){var d;e.preventDefault();d=this.href.split("#")[1];jQuery(".post").css("display","none");jQuery(".workflow-wrapper").css("min-height","0");jQuery(".workflow-wrapper").css("padding-bottom","0");jQuery("#"+d+".workflow-wrapper").css("min-height",c);jQuery("#"+d+".workflow-wrapper").css("padding-bottom",b);jQuery("#"+d+" .post").css("display","block");jQuery("#content-tabs li").removeClass("default-content-tab");jQuery(this).parent().parent().addClass("default-content-tab")})}};CommentPress.setup.comments=new function(){var a=this;this.init=function(){a.header();a.minimiser();a.comment_block_permalinks();a.comment_permalinks();a.comment_permalink_copy_links()};this.header=function(){jQuery("#sidebar").on("click","#comments_header h2 a",function(b){b.preventDefault();CommentPress.theme.sidebars.activate_sidebar("comments")})};this.minimiser=function(){jQuery("#sidebar").on("click","#cp_minimise_all_comments",function(b){b.preventDefault();jQuery("#comments_sidebar div.paragraph_wrapper").slideUp();jQuery.unhighlight_para()})};this.comment_block_permalinks=function(){if(cp_special_page=="1"){return}jQuery("a.comment_block_permalink").css("cursor","pointer");jQuery("#comments_sidebar").on("click","a.comment_block_permalink",function(e){var l,j,c,g,h,d,i,b,k,f;e.preventDefault();l=jQuery(this).parent().prop("id").split("para_heading-")[1];j=jQuery(this).parent().next("div.paragraph_wrapper");c=jQuery("#para_wrapper-"+l).find("ol.commentlist");g=false;h=j.css("display");if(h=="none"){g=true}if("undefined"!==typeof l){if(l!==""&&l!="pingbacksandtrackbacks"){d=jQuery("#textblock-"+l);if(g){jQuery.unhighlight_para();jQuery.highlight_para(d);jQuery.scroll_page(d)}else{if(cp_promote_reading=="0"){if(jQuery("#para_wrapper-"+l).find("#respond")[0]){jQuery.unhighlight_para()}else{if(!c[0]){jQuery.unhighlight_para();jQuery.highlight_para(d);jQuery.scroll_page(d)}}}else{if(jQuery.is_highlighted(d)){jQuery.unhighlight_para()}}}}else{jQuery.unhighlight_para();if(l!="pingbacksandtrackbacks"){CommentPress.theme.viewport.scroll_to_top(0,cp_scroll_speed);page_highlight=!page_highlight}}}if(cp_promote_reading=="0"&&l!="pingbacksandtrackbacks"){if(cp_comments_open=="y"){i=jQuery("#comment_post_ID").prop("value");b=jQuery("#para_wrapper-"+l+" .reply_to_para").prop("id");k=b.split("-")[1];f=jQuery("#para_wrapper-"+l).find("#respond")[0];if(c.length>0&&c[0]){if(!g&&!f){}else{addComment.moveFormToPara(k,l,i)}}else{if(!f){j.css("display","none");g=true}addComment.moveFormToPara(k,l,i)}}}j.slideToggle("slow",function(){if(g){jQuery.scroll_comments(jQuery("#para_heading-"+l),cp_scroll_speed)}})})};this.comment_permalinks=function(){jQuery("#comments_sidebar").on("click",".comment_permalink",function(e){var d,b,c;e.preventDefault();d=this.href.split("#")[1];if(cp_special_page=="1"){b=CommentPress.theme.header.get_offset();jQuery.scrollTo(jQuery("#"+d),{duration:cp_scroll_speed,axis:"y",offset:b})}else{jQuery.unhighlight_para();c=jQuery.get_text_sig_by_comment_id("#"+d);if(c!="pingbacksandtrackbacks"){jQuery.scroll_page_to_textblock(c)}jQuery.scroll_comments(jQuery("#"+d),cp_scroll_speed)}})};this.comment_permalink_copy_links=function(){jQuery("#comments_sidebar").on("click",".comment_permalink_copy",function(c){var b;b=jQuery(this).parent().attr("href");if(b){window.prompt("Copy this link, then paste into where you need it",b)}})};this.comment_rollovers=function(){jQuery("#comments_sidebar").on("mouseenter",".comment-wrapper",function(b){jQuery(this).addClass("background-highlight")});jQuery("#comments_sidebar").on("mouseleave",".comment-wrapper",function(b){jQuery(this).removeClass("background-highlight")})}};CommentPress.setup.activity=new function(){var a=this;this.init=function(){a.header();a.minimiser();a.headings();a.see_in_context_links()};this.header=function(){jQuery("#sidebar").on("click","#activity_header h2 a",function(b){b.preventDefault();CommentPress.theme.sidebars.activate_sidebar("activity")})};this.minimiser=function(){jQuery("#sidebar").on("click","#cp_minimise_all_activity",function(b){b.preventDefault();jQuery("#activity_sidebar div.paragraph_wrapper").slideUp()})};this.headings=function(){jQuery("h3.activity_heading").css("cursor","pointer");jQuery("#activity_sidebar").on("click","h3.activity_heading",function(c){var b;c.preventDefault();b=jQuery(this).next("div.paragraph_wrapper");b.css("width",jQuery(this).parent().css("width"));b.slideToggle("slow",function(){b.css("width","auto")})})};this.see_in_context_links=function(){if(cp_special_page=="1"){return}jQuery("#activity_sidebar").on("click","a.comment_on_post",function(g){var e,h,b,f,c,d;g.preventDefault();CommentPress.theme.sidebars.activate_sidebar("comments");e=this.href.split("#")[1];h=jQuery("#"+e);b=h.parents("div.paragraph_wrapper").map(function(){return this});if(b.length>0){f=jQuery(b[0]);f.show();if(cp_special_page=="1"){c=CommentPress.theme.header.get_offset();jQuery.scrollTo(h,{duration:cp_scroll_speed,axis:"y",offset:c})}else{jQuery.unhighlight_para();d=f.prop("id").split("-")[1];jQuery.scroll_page_to_textblock(d);jQuery("#comments_sidebar .sidebar_contents_wrapper").scrollTo(h,{duration:cp_scroll_speed,axis:"y",onAfter:function(){jQuery.highlight_comment(h)}})}}})}};(function($){var highlighted_para="";$.highlight_para=function(element){if(typeof(element)!="object"){return}element.addClass("selected_para")};$.unhighlight_para=function(){var highlighted_paras=$(".textblock");highlighted_paras.removeClass("selected_para")};$.get_highlighted_para=function(){return highlighted_para};$.is_highlighted=function(element){if(typeof(element)!="object"){return false}if(element.hasClass("selected_para")){return true}else{return false}};$.set_sidebar_height=function(){var sidebar=$("#sidebar");var sidebar_inner=$("#sidebar_inner");var sidebar_container=$("#toc_sidebar");var header=$("#"+$.get_sidebar_name()+"_sidebar .sidebar_header");var minimiser=$.get_sidebar_pane();var s_top=sidebar.offset().top;var sidebar_inside_h=$.get_element_adjust(sidebar);var sidebar_inner_inside_h=$.get_element_adjust(sidebar_inner);var sidebar_diff=s_top+sidebar_inside_h+sidebar_inner_inside_h;var sc_top=sidebar_container.position().top;var sc_inside_h=$.get_element_adjust(sidebar_container);var sc_diff=sc_top+sc_inside_h;var header_diff=0;if(header.css("display")!="none"){header_diff=header.height()+$.get_element_adjust(header)}var minimiser_diff=$.get_element_adjust(minimiser);if(cp_is_signup_page=="1"){var bottom_margin=$.css_to_num($.px_to_num($("#content").css("margin-bottom")))}else{var bottom_margin=$.css_to_num($.px_to_num($("#page_wrapper").css("margin-bottom")))}var viewport_height=$(window).height();var viewport_scrolltop=$(window).scrollTop();var viewport=viewport_height+viewport_scrolltop;var to_bottom=viewport-(sidebar_diff+sc_diff+header_diff+minimiser_diff+bottom_margin);$("#sidebar div.sidebar_contents_wrapper").css("height",to_bottom+"px");return to_bottom};$.get_element_adjust=function(element){var w_bt=$.css_to_num($.px_to_num(element.css("borderTopWidth")));var w_bb=$.css_to_num($.px_to_num(element.css("borderBottomWidth")));var w_pad_t=$.css_to_num($.px_to_num(element.css("padding-top")));var w_pad_b=$.css_to_num($.px_to_num(element.css("padding-bottom")));var w_mar_t=$.css_to_num($.px_to_num(element.css("margin-top")));var w_mar_b=$.css_to_num($.px_to_num(element.css("margin-bottom")));var element_adjust=w_bt+w_bb+w_pad_t+w_pad_b+w_mar_t+w_mar_b;return element_adjust};$.get_sidebar_pane=function(){var name=$.get_sidebar_name();return $("#"+name+"_sidebar .sidebar_minimiser")};$.get_sidebar_name=function(){var name="toc";if(cp_default_sidebar=="comments"){name="comments";if(cp_toc_on_top=="y"){name="toc"}}if(cp_default_sidebar=="activity"){name="activity";if(cp_toc_on_top=="y"){name="toc"}}return name};$.get_current_menu_item_id=function(){var current_menu_item=0,current_menu_obj,current_item_id,current_item_classes,current_item_class;current_menu_obj=$(".current_page_item");if(current_menu_obj.length>0){current_item_id=current_menu_obj.prop("id");if(current_item_id.length>0){current_menu_item=current_item_id.split("-")[2]}else{current_item_class=current_menu_obj.prop("class");current_item_classes=current_item_class.split(" ");for(var i=0,item;item=current_item_classes[i++];){if(item.match("page-item-")){current_menu_item=item.split("-")[2];break}}}}return current_menu_item};$.in_array=function(needle,haystack,argStrict){var found=false,key,strict=!!argStrict;for(key in haystack){if((strict&&haystack[key]===needle)||(!strict&&haystack[key]==needle)){found=true;break}}return found};$.remove_from_array=function(item,sourceArray){for(var i=0;i<sourceArray.length;i++){if(item===sourceArray[i]){sourceArray.splice(i,1);break}}return sourceArray};$.is_object=function(mixed_var){if(mixed_var instanceof Array){return false}else{return(mixed_var!==null)&&(typeof(mixed_var)=="object")}};$.is_function_defined=function(function_name){if(eval("typeof("+function_name+") == typeof(Function)")){return true}return false};$.px_to_num=function(pix){return parseInt(pix.substring(0,(pix.length-2)))};$.css_to_num=function(strNum){if(strNum&&strNum!=""){var i=parseFloat(strNum);if(i.toString()=="NaN"){return 0}else{return i}}return 0};$.frivolous=function(message){alert(message)};$.highlight_comment=function(comment){comment.addClass("notransition");if(comment.hasClass("comment-fade")){comment.removeClass("comment-fade")}if(comment.hasClass("comment-highlighted")){comment.removeClass("comment-highlighted")}comment.addClass("comment-highlighted");comment.removeClass("notransition");comment.height();comment.addClass("comment-fade")};$.get_text_sig_by_comment_id=function(cid){var comment_id,para_wrapper_array,text_sig,item;text_sig="";if(cid.match("#comment-")){comment_id=parseInt(cid.split("#comment-")[1])}para_wrapper_array=$("#comment-"+comment_id).parents("div.paragraph_wrapper").map(function(){return this});if(para_wrapper_array.length>0){item=$(para_wrapper_array[0]);text_sig=item.prop("id").split("-")[1]}return text_sig};$.on_load_scroll_to_comment=function(){var url,comment_id,comment;url=document.location.toString();if(url.match("#comment-")){comment_id=url.split("#comment-")[1];comment=$("#comment-"+comment_id);if(comment.length){if(cp_is_mobile=="0"||cp_is_tablet=="1"){$.scrollTo(comment,{duration:cp_scroll_speed,axis:"y",offset:CommentPress.theme.header.get_offset()})}}}};$.scroll_comments=function(target,speed,flash){switch(arguments.length){case 2:flash="noflash";break;case 3:break;default:throw new Error("illegal argument count")}if(cp_is_mobile=="0"||cp_is_tablet=="1"){if(flash=="flash"){$("#comments_sidebar .sidebar_contents_wrapper").scrollTo(target,{duration:speed,axis:"y",onAfter:function(){jQuery.highlight_comment(target);$(document).trigger("commentpress-comments-scrolled")}})}else{$("#comments_sidebar .sidebar_contents_wrapper").scrollTo(target,{duration:speed,onAfter:function(){$(document).trigger("commentpress-comments-scrolled")}})}}};$.scroll_page=function(target){if(typeof target==="undefined"){return}if(cp_is_mobile=="0"||cp_is_tablet=="1"){$.scrollTo(target,{duration:(cp_scroll_speed*1.5),axis:"y",offset:CommentPress.theme.header.get_offset()})}};$.quick_scroll_page=function(target,duration){if(typeof target==="undefined"){return}if(cp_is_mobile=="0"||cp_is_tablet=="1"){$.scrollTo(target,{duration:(duration*1.5),axis:"y",offset:CommentPress.theme.header.get_offset()})}};$.scroll_page_to_textblock=function(text_sig){var textblock;if(text_sig!==""){textblock=$("#textblock-"+text_sig);$.highlight_para(textblock);$.scroll_page(textblock)}else{if(page_highlight===false){CommentPress.theme.viewport.scroll_to_top(0,cp_scroll_speed)}page_highlight=!page_highlight}}})(jQuery);function commentpress_setup_init(){CommentPress.setup.navigation.init();CommentPress.setup.content.init();CommentPress.setup.comments.init();CommentPress.setup.activity.init();jQuery(document).trigger("commentpress-initialised")}jQuery(document).ready(function(a){commentpress_setup_init()});