function cpajax_reenable_featured_comments(){"undefined"!=typeof featured_comments&&jQuery.is_function_defined("featured_comments_click")&&featured_comments_click()}function cpajax_reenable_comment_upvoter(){"undefined"!=typeof comment_upvoter&&jQuery.is_function_defined("comment_upvoter_click")&&comment_upvoter_click()}CommentPress.ajax={},CommentPress.ajax.comments=new function(){var e=this,a=jQuery.noConflict();this.cpajax_submitting=!1,this.cpajax_form={},this.cpajax_error={},"undefined"!=typeof CommentpressAjaxSettings&&(this.cpajax_live=CommentpressAjaxSettings.cpajax_live,this.cpajax_ajax_url=CommentpressAjaxSettings.cpajax_ajax_url,this.cpajax_spinner_url=CommentpressAjaxSettings.cpajax_spinner_url,this.cpajax_post_id=CommentpressAjaxSettings.cpajax_post_id,this.cpajax_lang=CommentpressAjaxSettings.cpajax_lang),this.init=function(){},this.dom_ready=function(){a("#respond_title").after('<div id="cpajax_error_msg"></div>'),a("#submit").after('<img src="'+e.cpajax_spinner_url+'" id="loading" alt="'+e.cpajax_lang[0]+'" />'),a("#loading").hide(),e.cpajax_form=a("#commentform"),e.cpajax_error=a("#cpajax_error_msg"),e.cpajax_error.hide(),e.initialise_form()},this.reset=function(){a("#loading").hide(),a("#submit").removeAttr("disabled"),a("#submit").show(),addComment.enableForm(),e.cpajax_submitting=!1},this.add_comment=function(n){var t,r,i,o;t=e.cpajax_form.find("#comment_parent").val(),r=a("ol.commentlist:first"),"0"!=t?(i="#li-comment-"+t,child_list=a(i+" > ol.children:first"),child_list[0]?e.nice_append(n,i+" > ol.children:first > li:last",child_list,i+" > ol.children:first > li:last"):e.nice_append(n,i+" > ol.children:first",i,i+" > ol.children:first > li:last")):r[0]?e.nice_append(n,"ol.commentlist:first > li:last",r,"ol.commentlist:first > li:last"):e.nice_append(n,"ol.commentlist:first","div.comments_container","ol.commentlist:first > li:last"),o=n.find("#comments_in_page_wrapper div.comments_container > h3.general_comments_header"),a("#comments_in_page_wrapper div.comments_container > h3.general_comments_header").replaceWith(o),e.cpajax_form.find("#comment").val(""),cpajax_reenable_featured_comments(),cpajax_reenable_comment_upvoter()},this.nice_append=function(a,n,t,r){"undefined"!=typeof a&&null!==a&&(a.find(n).clone().hide().appendTo(t),e.cleanup(n,r))},this.nice_prepend=function(a,n,t,r){"undefined"!=typeof a&&null!==a&&(a.find(n).clone().hide().prependTo(t),e.cleanup(n,r))},this.cleanup=function(e,n){var t,r,i;t=a(n).prop("id"),r="#comment-"+t.toString().split("-")[2],i=a(r),addComment.cancelForm(),i.addClass("comment-highlighted"),a(e).slideDown("slow",function(){a(window).stop(!0).scrollTo(i,{duration:cp_scroll_speed,axis:"y",offset:CommentPress.theme.header.get_offset(),onAfter:function(){i.addClass("comment-fade")}})})},this.initialise_form=function(){a("#commentform").off("submit"),a("#commentform").on("submit",function(n){var t;if(e.cpajax_submitting=!0,e.cpajax_error.hide(),e.cpajax_form.find("#author")[0]){if(""==e.cpajax_form.find("#author").val())return e.cpajax_error.html('<span class="error">'+e.cpajax_lang[1]+"</span>"),e.cpajax_error.show(),e.cpajax_submitting=!1,!1;if(""==e.cpajax_form.find("#email").val())return e.cpajax_error.html('<span class="error">'+e.cpajax_lang[2]+"</span>"),e.cpajax_error.show(),e.cpajax_submitting=!1,!1;if(t=/^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/,!t.test(e.cpajax_form.find("#email").val()))return e.cpajax_error.html('<span class="error">'+e.cpajax_lang[3]+"</span>"),e.cpajax_error.show(),n.preventDefault&&n.preventDefault(),e.cpajax_submitting=!1,!1}return"1"==cp_tinymce&&(tinyMCE.triggerSave(),addComment.disableForm()),""==e.cpajax_form.find("#comment").val()?(e.cpajax_error.html('<span class="error">'+e.cpajax_lang[4]+"</span>"),e.cpajax_error.show(),addComment.enableForm(),e.cpajax_submitting=!1,!1):(a(this).ajaxSubmit({beforeSubmit:function(){a("#loading").show(),a("#submit").prop("disabled","disabled"),a("#submit").hide()},error:function(a){var n;return e.cpajax_error.empty(),n=a.responseText.match(/<p>(.*)<\/p>/),e.cpajax_error.html('<span class="error">'+n[1]+"</span>"),e.cpajax_error.show(),e.reset(),!1},success:function(n){var t;t=a(a.parseHTML?a.parseHTML(n):n);try{e.add_comment(t),e.reset()}catch(r){e.reset(),alert(e.cpajax_lang[6]+"\n\n"+r)}}}),!1)})}},CommentPress.ajax.comments.init(),jQuery(document).ready(function(e){CommentPress.ajax.comments.dom_ready()});