function cpajax_reenable_featured_comments(){"undefined"!=typeof featured_comments&&jQuery.is_function_defined("featured_comments_click")&&featured_comments_click()}function cpajax_reenable_comment_upvoter(){"undefined"!=typeof comment_upvoter&&jQuery.is_function_defined("comment_upvoter_click")&&comment_upvoter_click()}CommentPress.ajax={},CommentPress.ajax.comments=new function(){var me=this,$=jQuery.noConflict();this.cpajax_submitting=!1,this.cpajax_form={},this.cpajax_error={},"undefined"!=typeof CommentpressAjaxSettings&&(this.cpajax_live=CommentpressAjaxSettings.cpajax_live,this.cpajax_ajax_url=CommentpressAjaxSettings.cpajax_ajax_url,this.cpajax_spinner_url=CommentpressAjaxSettings.cpajax_spinner_url,this.cpajax_post_id=CommentpressAjaxSettings.cpajax_post_id,this.cpajax_lang=CommentpressAjaxSettings.cpajax_lang),this.init=function(){},this.dom_ready=function(){me.updater(me.cpajax_live),$("#respond_title").after('<div id="cpajax_error_msg"></div>'),$("#submit").after('<img src="'+me.cpajax_spinner_url+'" id="loading" alt="'+me.cpajax_lang[0]+'" />'),$("#loading").hide(),me.cpajax_form=$("#commentform"),me.cpajax_error=$("#cpajax_error_msg"),me.cpajax_error.hide(),me.initialise_form(),me.reassign_comments(),me.listeners()},this.listeners=function(){$(document).on("commentpress-document-ready",function(a){me.reassign_comments(),cpajax_reenable_featured_comments(),cpajax_reenable_comment_upvoter()}),$(document).on("fee-after-save",function(a){me.reassign_comments(),cpajax_reenable_featured_comments(),cpajax_reenable_comment_upvoter()})},this.reset=function(){$("#loading").hide(),$("#submit").removeAttr("disabled"),$("#submit").show(),addComment.enableForm(),me.cpajax_submitting=!1},this.updater=function(a){"1"==a?CommentpressAjaxSettings.interval=window.setInterval(me.update,5e3):window.clearInterval(CommentpressAjaxSettings.interval)},this.update=function(){me.cpajax_submitting||$.post(me.cpajax_ajax_url,{action:"cpajax_get_new_comments",last_count:CommentpressAjaxSettings.cpajax_comment_count,post_id:me.cpajax_post_id},function(a,b){"success"==b&&me.callback(a)},"json")},this.callback=function(data){var diff,i,comment;if(diff=parseInt(data.cpajax_comment_count)-parseInt(CommentpressAjaxSettings.cpajax_comment_count),diff>0)for(i=1;i<=diff;i++)comment=eval("data.cpajax_new_comment_"+i),me.add_new_comment($(comment.markup),comment.text_sig,comment.parent,comment.id),CommentpressAjaxSettings.cpajax_comment_count++},this.add_new_comment=function(a,b,c,d){var e,f,g,h,i,j,k,m,n;e=$("div.comments_container"),e.find("#li-comment-"+d)[0]||(f="#para_wrapper-"+b,g="#para_heading-"+b,h=$(f+" ol.commentlist:first"),"0"!=c?(i="#li-comment-"+c,j=$(i+" > ol.children:first"),j[0]?a.hide().addClass("comment-highlighted").appendTo(j).slideDown("fast",function(){a.addClass("comment-fade")}):a.wrap('<ol class="children" />').parent().addClass("comment-highlighted").hide().appendTo(i).slideDown("fast",function(){a.parent().addClass("comment-fade")})):h[0]?a.hide().addClass("comment-highlighted").appendTo(h).slideDown("fast",function(){a.addClass("comment-fade")}):a.wrap('<ol class="commentlist" />').parent().addClass("comment-highlighted").hide().prependTo(f).slideDown("fast",function(){a.parent().addClass("comment-fade")}),m=parseInt($(g+" a span.cp_comment_num").text()),n=m+1,me.update_comments_para_heading(g,n),k=$(g),k.addClass("notransition"),k.hasClass("heading-fade")&&k.removeClass("heading-fade"),k.hasClass("heading-highlighted")&&k.removeClass("heading-highlighted"),k.addClass("heading-highlighted"),k.removeClass("notransition"),k.height(),k.addClass("heading-fade"),me.update_para_icon(b,n),me.reassign_comments(),cpajax_reenable_featured_comments(),cpajax_reenable_comment_upvoter(),$(document).trigger("commentpress-ajax-new-comment-added",[d]))},this.reassign_comments=function(){var a,b,c,d,e,f,a=$("#comments_sidebar .comment-wrapper .comment-assign");a.show(),a.draggable({helper:"clone",cursor:"move"}),b=$("#content .post .textblock"),b.droppable({accept:".comment-assign",hoverClass:"selected_para selected_dropzone",drop:function(a,b){c=$(this).prop("id").split("-")[1],d={resizable:!1,width:400,height:200,zIndex:3999,modal:!0,dialogClass:"wp-dialog",buttons:{Yes:function(){$(this).dialog("option","disabled",!0),$(".ui-dialog-buttonset").html('<img src="'+me.cpajax_spinner_url+'" id="loading" alt="'+me.cpajax_lang[0]+'" />'),$(".ui-dialog-title").html(me.cpajax_lang[9]),$(".cp_alert_text").html(me.cpajax_lang[10]),me.reassign(c,b)},Cancel:function(){$(this).dialog("close"),$(this).dialog("destroy"),$(this).remove()}}},e=me.cpajax_lang[8],f=$('<div><p class="cp_alert_text">'+e+"</p></div>"),f.prop("title",me.cpajax_lang[7]).appendTo("body").dialog(d)}})},this.reassign=function(a,b){var c,d,e,f,g;c=$(b.draggable).prop("id").split("-")[1],d=$(b.draggable).closest("li.comment"),e=d,f=d.siblings("li.comment"),0==f.length&&(g=d.parent("ol.commentlist"),e=g),$(e).slideUp("slow",function(){$.post(me.cpajax_ajax_url,{action:"cpajax_reassign_comment",text_signature:a,comment_id:c},function(a,b){"success"==b?document.location.reload(!0):alert(b)},"json")})},this.add_comment=function(a){var b,c,d,e,f,g,h,i,j,k;b=me.cpajax_form.find("#text_signature").val(),c=me.cpajax_form.find("#comment_parent").val(),d="#para_wrapper-"+b,e="#para_heading-"+b,$(d).removeClass("no_comments"),$(e).removeClass("no_comments"),"0"!=c?(f="#li-comment-"+c,g=$(f+" > ol.children:first"),k=g[0]?me.nice_append(a,f+" > ol.children:first > li:last",g,f+" > ol.children:first > li:last"):me.nice_append(a,f+" > ol.children:first",f,f+" > ol.children:first > li:last")):(h=$(d+" > ol.commentlist:first"),k=h[0]?me.nice_append(a,d+" > ol.commentlist:first > li:last",h,d+" > ol.commentlist:first > li:last"):me.nice_prepend(a,d+" > ol.commentlist:first",d,d+" > ol.commentlist:first > li:last")),$("#respond").slideUp("fast",function(){addComment.cancelForm()}),i=parseInt($(e+" a span.cp_comment_num").text()),j=i+1,me.update_comments_para_heading(e,j),me.update_para_icon(b,j),""!=b?CommentPress.common.content.scroll_page($("#textblock-"+b)):CommentPress.theme.viewport.scroll_to_top(0,cp_scroll_speed),me.reassign_comments(),me.cpajax_form.find("#comment").val(""),cpajax_reenable_featured_comments(),cpajax_reenable_comment_upvoter(),$(document).trigger("commentpress-ajax-comment-added",[k])},this.nice_append=function(a,b,c,d){var e,f;if("undefined"!=typeof a&&null!==a)return e=a.find(b).clone(),e.appendTo(c).hide(),f=me.cleanup(b,d)},this.nice_prepend=function(a,b,c,d){var e,f;if("undefined"!=typeof a&&null!==a)return e=a.find(b).clone(),e.prependTo(c).hide(),f=me.cleanup(b,d)},this.cleanup=function(a,b){var c,d,e;return c=$(b).prop("id"),d="#comment-"+c.toString().split("-")[2],e=$(d),e.addClass("comment-highlighted"),$(a).slideDown("slow",function(){$("#comments_sidebar .sidebar_contents_wrapper").stop(!0).scrollTo(e,{duration:cp_scroll_speed,axis:"y",onAfter:function(){e.addClass("comment-fade"),$(document).trigger("commentpress-ajax-comment-added-scrolled")}})}),d},this.update_comments_para_heading=function(a,b){$(a+" a span.cp_comment_num").text(b.toString()),1==b&&$(a+" a span.cp_comment_word").text(me.cpajax_lang[11]),b>1&&$(a+" a span.cp_comment_word").text(me.cpajax_lang[12])},this.update_para_icon=function(a,b){var c;c="#textblock-"+a,$(c+" span small").text(b.toString()),1==b&&($(c+" span.commenticonbox a.para_permalink").removeClass("no_comments"),$(c+" span.commenticonbox a.para_permalink").addClass("has_comments"),$(c+" span small").css("visibility","visible"))},this.initialise_form=function(){$("#commentform").off("submit"),$("#commentform").on("submit",function(a){var b;if(me.cpajax_submitting=!0,me.cpajax_error.hide(),me.cpajax_form.find("#author")[0]){if(""==me.cpajax_form.find("#author").val())return me.cpajax_error.html('<span class="error">'+me.cpajax_lang[1]+"</span>"),me.cpajax_error.show(),me.cpajax_submitting=!1,!1;if(""==me.cpajax_form.find("#email").val())return me.cpajax_error.html('<span class="error">'+me.cpajax_lang[2]+"</span>"),me.cpajax_error.show(),me.cpajax_submitting=!1,!1;if(b=/^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/,!b.test(me.cpajax_form.find("#email").val()))return me.cpajax_error.html('<span class="error">'+me.cpajax_lang[3]+"</span>"),me.cpajax_error.show(),a.preventDefault&&a.preventDefault(),me.cpajax_submitting=!1,!1}return"1"==cp_tinymce&&(tinyMCE.triggerSave(),addComment.disableForm()),""==me.cpajax_form.find("#comment").val()?(me.cpajax_error.html('<span class="error">'+me.cpajax_lang[4]+"</span>"),me.cpajax_error.show(),addComment.enableForm(),me.cpajax_submitting=!1,!1):($(this).ajaxSubmit({beforeSubmit:function(){$("#loading").show(),$("#submit").prop("disabled","disabled"),$("#submit").hide()},error:function(a){var b;return me.cpajax_error.empty(),b=a.responseText.match(/<p>(.*)<\/p>/),me.cpajax_error.html('<span class="error">'+b[1]+"</span>"),me.cpajax_error.show(),me.reset(),!1},success:function(a){var b;b=$($.parseHTML?$.parseHTML(a):a);try{me.add_comment(b),me.reset()}catch(a){me.reset(),alert(me.cpajax_lang[6]+"\n\n"+a)}}}),!1)})}},CommentPress.ajax.comments.init(),jQuery(document).ready(function(a){CommentPress.ajax.comments.dom_ready()});
