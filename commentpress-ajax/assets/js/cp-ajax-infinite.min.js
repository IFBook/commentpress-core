CommentPress.infinite={},CommentPress.infinite.settings=new function(){var t=this,e=jQuery.noConflict();this.init=function(){t.init_post_url(),t.init_post_title()},this.dom_ready=function(){},this.posts=new Array,this.set_posts=function(t){this.posts=t},this.get_posts=function(){return this.posts},this.in_posts=function(t){return e.in_array(t,this.posts)},this.add_to_posts=function(t){this.posts.push(t)},this.post_url="",this.init_post_url=function(){this.post_url=document.location.href},this.set_post_url=function(t){this.post_url=t},this.get_post_url=function(){return this.post_url},this.post_title="",this.init_post_title=function(){this.post_title=document.title},this.set_post_title=function(t){this.post_title=t},this.get_post_title=function(){return this.post_title},this.post_comments_open="n",this.set_post_comments_open=function(t){this.post_comments_open=t},this.get_post_comments_open=function(){return this.post_comments_open},this.comments=new Array,this.set_comments=function(t){this.comments=t},this.get_comments=function(){return this.comments},this.add_to_comments=function(t,e){this.comments[t]=e,this.comments.push(t)}},CommentPress.infinite.DOM=new function(){var t=this,e=jQuery.noConflict();this.init=function(){},this.dom_ready=function(){t.init_waypoints(),t.init_popstate()},this.init_popstate=function(){window.onpopstate=function(t){t.state&&(document.title=t.state.page_title,e("#main_wrapper").prepend('<div class="page_wrapper cp_page_wrapper">'+t.state.html+"</div>"))}},this.init_waypoints=function(){e("#wrapper").waypoint(function(t){"down"===t&&CommentPress.infinite.page.load_next("waypoint")},{offset:"bottom-in-view"})},this.init_post_waypoint=function(n){e("#post-"+n+".post").parent().parent().waypoint(function(n){"down"===n&&t.update_dom(e(this))},{triggerOnce:!0,offset:function(){var t;return t=e("#header").height(),"y"==CommentPress.settings.DOM.get_wp_adminbar()&&(t+=CommentPress.settings.DOM.get_wp_adminbar_height()),t}})},this.handle_ajax_data=function(n,i){var s,o,m,r,a,p,_,c;c=e("#main_wrapper .post:last-child").prop("id").split("-")[1],CommentPress.infinite.settings.set_post_url(n.url),CommentPress.infinite.settings.set_post_title(n.title),r=e("#main_wrapper .post:last-child").prop("class"),s=e(".post",e(n.content)),e("#main_wrapper").append(s.parents(".page_wrapper")),o=s.prop("id"),"undefined"!=typeof o&&(CommentPress.infinite.settings.add_to_posts(c),m=o.split("-")[1],p=e(".comments_container",e(n.comments)),0!==CommentPress.infinite.commentform.get_comments_form()&&(_=CommentPress.infinite.commentform.get_comments_form().clone(),e("form",_).attr("id","commentform"),e("#comment_post_ID",_).val(m),CommentPress.infinite.settings.set_comments(p.append(_)),CommentPress.infinite.settings.set_post_comments_open("n"),"open"==n.comment_status&&CommentPress.infinite.settings.set_post_comments_open("y")),"post"!=r&&(a=r.split("-")[1],r.match("wpcustom_menuid-")?CommentPress.infinite.menu.update_custom(a):CommentPress.infinite.menu.update_pages(a)),t.init_post_waypoint(m),e(document).trigger("commentpress-new-post-loaded"),t.refresh()),e.waypoints("refresh"),"link"==i&&CommentPress.common.content.scroll_page(s)},this.refresh=function(){CommentPress.ajax.comments.reassign_comments(),CommentPress.ajax.comments.initialise(),CommentPress.ajax.comments.initialise_form(),e.is_function_defined("bpgsites_init_elements")&&bpgsites_init_elements()},this.update_dom=function(t){var n,i,s,o,m,r,a;n=e(".post",t),i=n.prop("id").split("-")[1],s=n.prop("class"),"post"!=s&&(menu_item_id=s.split("-")[1],s.match("wpcustom_menuid-")?CommentPress.infinite.menu.update_custom(menu_item_id):CommentPress.infinite.menu.update_pages(menu_item_id),e("#wrapper").waypoint("disable"),o=e("#main_wrapper"),m=t.prev(),m.waypoint("destroy"),t.waypoint("destroy"),o.css("position","fixed"),m.remove(),document.title=CommentPress.infinite.settings.get_post_title(),window.history&&(r=t.html().trim(),window.history.pushState({post_id:i,post_permalink:CommentPress.infinite.settings.get_post_url(),page_title:CommentPress.infinite.settings.get_post_title(),html:r,comment_status:cp_comments_open},"",CommentPress.infinite.settings.get_post_url())),e(document).scrollTop(0),o.css("position","relative"),e("#wrapper").waypoint("enable"),a=CommentPress.infinite.settings.get_comments(),0!==CommentPress.infinite.commentform.get_comments_form()&&addComment.disableForm(),e("#comments_sidebar .comments_container").replaceWith(a),cp_comments_open=CommentPress.infinite.settings.get_post_comments_open(),0!==CommentPress.infinite.commentform.get_comments_form()&&addComment.enableForm(),CommentPress.infinite.DOM.refresh(),e.waypoints("refresh"),e(document).trigger("commentpress-post-changed"))}},CommentPress.infinite.page=new function(){var t=this,e=jQuery.noConflict();this.init=function(){t.init_nonce()},this.dom_ready=function(){t.state_navigation()},this.cpajax_nonce="",this.init_nonce=function(){"undefined"!=typeof CommentpressAjaxInfiniteSettings&&(this.cpajax_nonce=CommentpressAjaxInfiniteSettings.nonce)},this.set_nonce=function(t){this.cpajax_nonce=t},this.get_nonce=function(){return this.cpajax_nonce},this.state_navigation=function(){e("#container").on("click",".previous_page",function(t){alert("back"),t.preventDefault&&t.preventDefault(),window.history.back()}),e("#container").on("click",".next_page",function(e){alert("forward"),e.preventDefault&&e.preventDefault(),t.load_next("link")})},this.load_next=function(n){var i;i=e("#main_wrapper .post:last-child").prop("id").split("-")[1],CommentPress.infinite.settings.in_posts(i)||(e("#main_wrapper").after('<div class="cp_next_page_loading_wrapper" style="text-align: center"><img src="'+cpajax_spinner_url+'" id="cp_next_page_loading" alt="'+cpajax_lang[0]+'" /></div>'),e.ajax({url:cpajax_ajax_url,type:"POST",dataType:"json",data:{action:"cpajax_load_next_page",current_post_id:i,nonce:t.get_nonce()},success:function(t){CommentPress.infinite.DOM.handle_ajax_data(t,n),e(".cp_next_page_loading_wrapper").remove()}}))}},CommentPress.infinite.menu=new function(){var t=jQuery.noConflict();this.init=function(){},this.dom_ready=function(){},this.update_custom=function(e){t("#toc_list .menu-item").removeClass("current_page_item"),t("#menu-item-"+e).addClass("current_page_item"),t("#toc_list .menu-item").removeClass("current_page_ancestor"),t("#menu-item-"+e).parents("li").addClass("current_page_ancestor")},this.CommentPress.infinite.menu.update_pages=function(e){t("#toc_list .page_item").removeClass("current_page_item"),t(".page-item-"+e).addClass("current_page_item"),t("#toc_list .page_item").removeClass("current_page_ancestor"),t(".page-item-"+e).parents("li").addClass("current_page_ancestor")}},CommentPress.infinite.comments=new function(){var t=jQuery.noConflict();this.init=function(){},this.dom_ready=function(){},this.store=function(){var e;e=t("#wrapper .post").prop("id").split("-")[1],CommentPress.infinite.settings_add_to_comments(e,t("#comments_sidebar .comments_container"))}},CommentPress.infinite.commentform=new function(){var t=this,e=jQuery.noConflict();this.init=function(){},this.dom_ready=function(){t.store()},this.comments_form=0,this.set_comments_form=function(t){this.comments_form=t},this.get_comments_form=function(){return this.comments_form},this.store=function(){var n;addComment.disableForm(),t.set_comments_form(e("#respond_wrapper").clone()),n=t.get_comments_form(),e("form",n).attr("id","commentform-disabled"),e("#respond_wrapper",n).hasClass("cp_force_displayed")&&e("#respond_wrapper",n).removeClass("cp_force_displayed"),e("#respond_wrapper",n).hasClass("cp_force_closed")&&e("#respond_wrapper",n).removeClass("cp_force_closed"),e("#respond_wrapper").hasClass("cp_force_closed")&&e("#respond_wrapper").remove()}},CommentPress.infinite.settings.init(),CommentPress.infinite.DOM.init(),CommentPress.infinite.page.init(),CommentPress.infinite.menu.init(),CommentPress.infinite.commentform.init(),CommentPress.infinite.comments.init(),jQuery(document).ready(function(){CommentPress.infinite.settings.dom_ready(),CommentPress.infinite.DOM.dom_ready(),CommentPress.infinite.page.dom_ready(),CommentPress.infinite.menu.dom_ready(),CommentPress.infinite.commentform.dom_ready(),CommentPress.infinite.comments.dom_ready()});
