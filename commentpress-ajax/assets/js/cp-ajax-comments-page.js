function cpajax_reenable_featured_comments(){"undefined"!=typeof featured_comments&&jQuery.is_function_defined("featured_comments_click")&&featured_comments_click()}function cpajax_reenable_comment_upvoter(){"undefined"!=typeof comment_upvoter&&jQuery.is_function_defined("comment_upvoter_click")&&comment_upvoter_click()}CommentPress.ajax={},CommentPress.ajax.comments=new function(){var e=this,a=jQuery.noConflict();this.cpajax_submitting=!1,this.cpajax_form={},this.cpajax_error={},"undefined"!=typeof CommentpressAjaxSettings&&(this.cpajax_live=CommentpressAjaxSettings.cpajax_live,this.cpajax_ajax_url=CommentpressAjaxSettings.cpajax_ajax_url,this.cpajax_spinner_url=CommentpressAjaxSettings.cpajax_spinner_url,this.cpajax_post_id=CommentpressAjaxSettings.cpajax_post_id,this.cpajax_lang=CommentpressAjaxSettings.cpajax_lang),this.initialise=function(){a("#respond_title").after('<div id="cpajax_error_msg"></div>'),a("#submit").after('<img src="'+e.cpajax_spinner_url+'" id="loading" alt="'+e.cpajax_lang[0]+'" />'),a("#loading").hide(),e.cpajax_form=a("#commentform"),e.cpajax_error=a("#cpajax_error_msg"),e.cpajax_error.hide()},this.reset=function(){a("#loading").hide(),a("#submit").removeAttr("disabled"),a("#submit").show(),addComment.enableForm(),e.cpajax_submitting=!1},this.add_comment=function(t){var n,i,r,o;n=e.cpajax_form.find("#comment_parent").val(),i=a("ol.commentlist:first"),"0"!=n?(r="#li-comment-"+n,child_list=a(r+" > ol.children:first"),child_list[0]?e.nice_append(t,r+" > ol.children:first > li:last",child_list,r+" > ol.children:first > li:last"):e.nice_append(t,r+" > ol.children:first",r,r+" > ol.children:first > li:last")):i[0]?e.nice_append(t,"ol.commentlist:first > li:last",i,"ol.commentlist:first > li:last"):e.nice_append(t,"ol.commentlist:first","div.comments_container","ol.commentlist:first > li:last"),o=t.find("#comments_in_page_wrapper div.comments_container > h3"),a("#comments_in_page_wrapper div.comments_container > h3").replaceWith(o),e.cpajax_form.find("#comment").val(""),cpajax_reenable_featured_comments(),cpajax_reenable_comment_upvoter()},this.nice_append=function(a,t,n,i){void 0!==a&&null!==a&&(a.find(t).clone().hide().appendTo(n),e.cleanup(t,i))},this.nice_prepend=function(a,t,n,i){void 0!==a&&null!==a&&(a.find(t).clone().hide().prependTo(n),e.cleanup(t,i))},this.cleanup=function(e,t){var n,i,r;n=a(t).prop("id"),i="#comment-"+n.toString().split("-")[2],r=a(i),addComment.cancelForm(),r.addClass("comment-highlighted"),a(e).slideDown("slow",function(){a.scrollTo(r,{duration:cp_scroll_speed,axis:"y",offset:CommentPress.theme.header.get_offset(),onAfter:function(){r.addClass("comment-fade")}})})},this.initialise_form=function(){a("#commentform").off("submit"),a("#commentform").on("submit",function(t){var n;if(e.cpajax_submitting=!0,e.cpajax_error.hide(),e.cpajax_form.find("#author")[0]){if(""==e.cpajax_form.find("#author").val())return e.cpajax_error.html('<span class="error">'+e.cpajax_lang[1]+"</span>"),e.cpajax_error.show(),e.cpajax_submitting=!1,!1;if(""==e.cpajax_form.find("#email").val())return e.cpajax_error.html('<span class="error">'+e.cpajax_lang[2]+"</span>"),e.cpajax_error.show(),e.cpajax_submitting=!1,!1;if(n=/^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/,!n.test(e.cpajax_form.find("#email").val()))return e.cpajax_error.html('<span class="error">'+e.cpajax_lang[3]+"</span>"),e.cpajax_error.show(),t.preventDefault&&t.preventDefault(),e.cpajax_submitting=!1,!1}return"1"==cp_tinymce&&(tinyMCE.triggerSave(),addComment.disableForm()),""==e.cpajax_form.find("#comment").val()?(e.cpajax_error.html('<span class="error">'+e.cpajax_lang[4]+"</span>"),e.cpajax_error.show(),addComment.enableForm(),e.cpajax_submitting=!1,!1):(a(this).ajaxSubmit({beforeSubmit:function(){a("#loading").show(),a("#submit").prop("disabled","disabled"),a("#submit").hide()},error:function(a){var t;return e.cpajax_error.empty(),t=a.responseText.match(/<p>(.*)<\/p>/),e.cpajax_error.html('<span class="error">'+t[1]+"</span>"),e.cpajax_error.show(),e.reset(),!1},success:function(t){var n;n=a(a.parseHTML?a.parseHTML(t):t);try{e.add_comment(n),e.reset()}catch(i){e.reset(),alert(e.cpajax_lang[6]+"\n\n"+i)}}}),!1)})}},jQuery(document).ready(function(e){CommentPress.ajax.comments.initialise(),CommentPress.ajax.comments.initialise_form()});