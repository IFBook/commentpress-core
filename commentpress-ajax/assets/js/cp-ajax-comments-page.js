CommentPress.ajax={};CommentPress.ajax.comments=new function(){var a=this;this.cpajax_submitting=false;this.cpajax_form={};this.cpajax_error={};if("undefined"!==typeof CommentpressAjaxSettings){this.cpajax_live=CommentpressAjaxSettings.cpajax_live;this.cpajax_ajax_url=CommentpressAjaxSettings.cpajax_ajax_url;this.cpajax_spinner_url=CommentpressAjaxSettings.cpajax_spinner_url;this.cpajax_post_id=CommentpressAjaxSettings.cpajax_post_id;this.cpajax_lang=CommentpressAjaxSettings.cpajax_lang}this.initialise=function(){jQuery("#respond_title").after('<div id="cpajax_error_msg"></div>');jQuery("#submit").after('<img src="'+a.cpajax_spinner_url+'" id="loading" alt="'+a.cpajax_lang[0]+'" />');jQuery("#loading").hide();a.cpajax_form=jQuery("#commentform");a.cpajax_error=jQuery("#cpajax_error_msg");a.cpajax_error.hide()};this.reset=function(){jQuery("#loading").hide();jQuery("#submit").removeAttr("disabled");jQuery("#submit").show();addComment.enableForm();a.cpajax_submitting=false};this.add_comment=function(b){var d,f,e,c;d=a.cpajax_form.find("#comment_parent").val();f=jQuery("ol.commentlist:first");if(d!="0"){e="#li-comment-"+d;child_list=jQuery(e+" > ol.children:first");if(child_list[0]){a.nice_append(b,e+" > ol.children:first > li:last",child_list,e+" > ol.children:first > li:last")}else{a.nice_append(b,e+" > ol.children:first",e,e+" > ol.children:first > li:last")}}else{if(f[0]){a.nice_append(b,"ol.commentlist:first > li:last",f,"ol.commentlist:first > li:last")}else{a.nice_append(b,"ol.commentlist:first","div.comments_container","ol.commentlist:first > li:last")}}commentpress_enable_comment_permalink_clicks();c=b.find("#comments_in_page_wrapper div.comments_container > h3");jQuery("#comments_in_page_wrapper div.comments_container > h3").replaceWith(c);a.cpajax_form.find("#comment").val("");cpajax_reenable_featured_comments();cpajax_reenable_comment_upvoter()};this.nice_append=function(b,d,e,c){if(b===undefined||b===null){return}b.find(d).clone().hide().appendTo(e);a.cleanup(d,c)};this.nice_prepend=function(b,d,e,c){if(b===undefined||b===null){return}b.find(d).clone().hide().prependTo(e);a.cleanup(d,c)};this.cleanup=function(d,c){var b,e,f;b=jQuery(c).prop("id");e="#comment-"+(b.toString().split("-")[2]);f=jQuery(e);addComment.cancelForm();f.addClass("comment-highlighted");jQuery(d).slideDown("slow",function(){jQuery.scrollTo(f,{duration:cp_scroll_speed,axis:"y",offset:commentpress_get_header_offset(),onAfter:function(){f.addClass("comment-fade")}})})};this.initialise_form=function(){jQuery("#commentform").off("submit");jQuery("#commentform").on("submit",function(c){var b;a.cpajax_submitting=true;a.cpajax_error.hide();if(a.cpajax_form.find("#author")[0]){if(a.cpajax_form.find("#author").val()==""){a.cpajax_error.html('<span class="error">'+a.cpajax_lang[1]+"</span>");a.cpajax_error.show();a.cpajax_submitting=false;return false}if(a.cpajax_form.find("#email").val()==""){a.cpajax_error.html('<span class="error">'+a.cpajax_lang[2]+"</span>");a.cpajax_error.show();a.cpajax_submitting=false;return false}b=/^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/;if(!b.test(a.cpajax_form.find("#email").val())){a.cpajax_error.html('<span class="error">'+a.cpajax_lang[3]+"</span>");a.cpajax_error.show();if(c.preventDefault){c.preventDefault()}a.cpajax_submitting=false;return false}}if(cp_tinymce=="1"){tinyMCE.triggerSave();addComment.disableForm()}if(a.cpajax_form.find("#comment").val()==""){a.cpajax_error.html('<span class="error">'+a.cpajax_lang[4]+"</span>");a.cpajax_error.show();addComment.enableForm();a.cpajax_submitting=false;return false}jQuery(this).ajaxSubmit({beforeSubmit:function(){jQuery("#loading").show();jQuery("#submit").prop("disabled","disabled");jQuery("#submit").hide()},error:function(d){var e;a.cpajax_error.empty();e=d.responseText.match(/<p>(.*)<\/p>/);a.cpajax_error.html('<span class="error">'+e[1]+"</span>");a.cpajax_error.show();a.reset();return false},success:function(f){var d;if(jQuery.parseHTML){d=jQuery(jQuery.parseHTML(f))}else{d=jQuery(f)}try{a.add_comment(d);a.reset()}catch(g){a.reset();alert(a.cpajax_lang[6]+"\n\n"+g)}}});return false})}};function cpajax_reenable_featured_comments(){if("undefined"!==typeof featured_comments){if(jQuery.is_function_defined("featured_comments_click")){featured_comments_click()}}}function cpajax_reenable_comment_upvoter(){if("undefined"!==typeof comment_upvoter){if(jQuery.is_function_defined("comment_upvoter_click")){comment_upvoter_click()}}}jQuery(document).ready(function(a){CommentPress.ajax.comments.initialise();CommentPress.ajax.comments.initialise_form()});