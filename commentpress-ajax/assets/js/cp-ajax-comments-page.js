CommentPress.ajax={};CommentPress.ajax.comments=new function(){var a=this,b=jQuery.noConflict();this.cpajax_submitting=false;this.cpajax_form={};this.cpajax_error={};if("undefined"!==typeof CommentpressAjaxSettings){this.cpajax_live=CommentpressAjaxSettings.cpajax_live;this.cpajax_ajax_url=CommentpressAjaxSettings.cpajax_ajax_url;this.cpajax_spinner_url=CommentpressAjaxSettings.cpajax_spinner_url;this.cpajax_post_id=CommentpressAjaxSettings.cpajax_post_id;this.cpajax_lang=CommentpressAjaxSettings.cpajax_lang}this.init=function(){};this.dom_ready=function(){b("#respond_title").after('<div id="cpajax_error_msg"></div>');b("#submit").after('<img src="'+a.cpajax_spinner_url+'" id="loading" alt="'+a.cpajax_lang[0]+'" />');b("#loading").hide();a.cpajax_form=b("#commentform");a.cpajax_error=b("#cpajax_error_msg");a.cpajax_error.hide();a.initialise_form()};this.reset=function(){b("#loading").hide();b("#submit").removeAttr("disabled");b("#submit").show();addComment.enableForm();a.cpajax_submitting=false};this.add_comment=function(c){var e,g,f,d;e=a.cpajax_form.find("#comment_parent").val();g=b("ol.commentlist:first");if(e!="0"){f="#li-comment-"+e;child_list=b(f+" > ol.children:first");if(child_list[0]){a.nice_append(c,f+" > ol.children:first > li:last",child_list,f+" > ol.children:first > li:last")}else{a.nice_append(c,f+" > ol.children:first",f,f+" > ol.children:first > li:last")}}else{if(g[0]){a.nice_append(c,"ol.commentlist:first > li:last",g,"ol.commentlist:first > li:last")}else{a.nice_append(c,"ol.commentlist:first","div.comments_container","ol.commentlist:first > li:last")}}d=c.find("#comments_in_page_wrapper div.comments_container > h3");b("#comments_in_page_wrapper div.comments_container > h3").replaceWith(d);a.cpajax_form.find("#comment").val("");cpajax_reenable_featured_comments();cpajax_reenable_comment_upvoter()};this.nice_append=function(c,e,f,d){if("undefined"===typeof c||c===null){return}c.find(e).clone().hide().appendTo(f);a.cleanup(e,d)};this.nice_prepend=function(c,e,f,d){if("undefined"===typeof c||c===null){return}c.find(e).clone().hide().prependTo(f);a.cleanup(e,d)};this.cleanup=function(e,d){var c,f,g;c=b(d).prop("id");f="#comment-"+(c.toString().split("-")[2]);g=b(f);addComment.cancelForm();g.addClass("comment-highlighted");b(e).slideDown("slow",function(){b.scrollTo(g,{duration:cp_scroll_speed,axis:"y",offset:CommentPress.theme.header.get_offset(),onAfter:function(){g.addClass("comment-fade")}})})};this.initialise_form=function(){b("#commentform").off("submit");b("#commentform").on("submit",function(d){var c;a.cpajax_submitting=true;a.cpajax_error.hide();if(a.cpajax_form.find("#author")[0]){if(a.cpajax_form.find("#author").val()==""){a.cpajax_error.html('<span class="error">'+a.cpajax_lang[1]+"</span>");a.cpajax_error.show();a.cpajax_submitting=false;return false}if(a.cpajax_form.find("#email").val()==""){a.cpajax_error.html('<span class="error">'+a.cpajax_lang[2]+"</span>");a.cpajax_error.show();a.cpajax_submitting=false;return false}c=/^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/;if(!c.test(a.cpajax_form.find("#email").val())){a.cpajax_error.html('<span class="error">'+a.cpajax_lang[3]+"</span>");a.cpajax_error.show();if(d.preventDefault){d.preventDefault()}a.cpajax_submitting=false;return false}}if(cp_tinymce=="1"){tinyMCE.triggerSave();addComment.disableForm()}if(a.cpajax_form.find("#comment").val()==""){a.cpajax_error.html('<span class="error">'+a.cpajax_lang[4]+"</span>");a.cpajax_error.show();addComment.enableForm();a.cpajax_submitting=false;return false}b(this).ajaxSubmit({beforeSubmit:function(){b("#loading").show();b("#submit").prop("disabled","disabled");b("#submit").hide()},error:function(e){var f;a.cpajax_error.empty();f=e.responseText.match(/<p>(.*)<\/p>/);a.cpajax_error.html('<span class="error">'+f[1]+"</span>");a.cpajax_error.show();a.reset();return false},success:function(g){var f;if(b.parseHTML){f=b(b.parseHTML(g))}else{f=b(g)}try{a.add_comment(f);a.reset()}catch(h){a.reset();alert(a.cpajax_lang[6]+"\n\n"+h)}}});return false})}};function cpajax_reenable_featured_comments(){if("undefined"!==typeof featured_comments){if(jQuery.is_function_defined("featured_comments_click")){featured_comments_click()}}}function cpajax_reenable_comment_upvoter(){if("undefined"!==typeof comment_upvoter){if(jQuery.is_function_defined("comment_upvoter_click")){comment_upvoter_click()}}}CommentPress.ajax.comments.init();jQuery(document).ready(function(a){CommentPress.ajax.comments.dom_ready()});