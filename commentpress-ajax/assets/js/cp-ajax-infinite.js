CommentPress.infinite={};CommentPress.infinite.settings=new function(){var a=this,b=jQuery.noConflict();this.init=function(){a.init_post_url();a.init_post_title()};this.dom_ready=function(){};this.posts=new Array;this.set_posts=function(c){this.posts=c};this.get_posts=function(){return this.posts};this.in_posts=function(c){return b.in_array(c,this.posts)};this.add_to_posts=function(c){this.posts.push(c)};this.post_url="";this.init_post_url=function(){this.post_url=document.location.href};this.set_post_url=function(c){this.post_url=c};this.get_post_url=function(){return this.post_url};this.post_title="";this.init_post_title=function(){this.post_title=document.title};this.set_post_title=function(c){this.post_title=c};this.get_post_title=function(){return this.post_title};this.post_comments_open="n";this.set_post_comments_open=function(c){this.post_comments_open=c};this.get_post_comments_open=function(){return this.post_comments_open};this.comments=new Array;this.set_comments=function(c){this.comments=c};this.get_comments=function(){return this.comments};this.add_to_comments=function(c,d){this.comments[c]=d;this.comments.push(c)}};CommentPress.infinite.DOM=new function(){var a=this,b=jQuery.noConflict();this.init=function(){};this.dom_ready=function(){a.init_waypoints();a.init_popstate()};this.init_popstate=function(){window.onpopstate=function(c){if(c.state){document.title=c.state.page_title;b("#main_wrapper").prepend('<div class="page_wrapper cp_page_wrapper">'+c.state.html+"</div>")}}};this.init_waypoints=function(){b("#wrapper").waypoint(function(c){if(c==="down"){CommentPress.infinite.page.load_next("waypoint")}else{}},{offset:"bottom-in-view"})};this.init_post_waypoint=function(c){b("#post-"+c+".post").parent().parent().waypoint(function(d){if(d==="down"){a.update_dom(b(this))}},{triggerOnce:true,offset:function(){var d;d=b("#header").height();if(CommentPress.settings.DOM.get_wp_adminbar()=="y"){d+=CommentPress.settings.DOM.get_wp_adminbar_height()}return d}})};this.handle_ajax_data=function(g,i){var l,f,h,d,c,k,j,e;e=b("#main_wrapper .post:last-child").prop("id").split("-")[1];CommentPress.infinite.settings.set_post_url(g.url);CommentPress.infinite.settings.set_post_title(g.title);d=b("#main_wrapper .post:last-child").prop("class");l=b(".post",b(g.content));b("#main_wrapper").append(l.parents(".page_wrapper"));f=l.prop("id");if(typeof f!=="undefined"){CommentPress.infinite.settings.add_to_posts(e);h=f.split("-")[1];k=b(".comments_container",b(g.comments));if(CommentPress.infinite.commentform.get_comments_form()!==0){j=CommentPress.infinite.commentform.get_comments_form().clone();b("form",j).attr("id","commentform");b("#comment_post_ID",j).val(h);CommentPress.infinite.settings.set_comments(k.append(j));CommentPress.infinite.settings.set_post_comments_open("n");if(g.comment_status=="open"){CommentPress.infinite.settings.set_post_comments_open("y")}}if(d!="post"){c=d.split("-")[1];if(d.match("wpcustom_menuid-")){CommentPress.infinite.menu.update_custom(c)}else{CommentPress.infinite.menu.update_pages(c)}}a.init_post_waypoint(h);b(document).trigger("commentpress-new-post-loaded");a.refresh()}b.waypoints("refresh");if(i=="link"){CommentPress.common.content.scroll_page(l)}};this.refresh=function(){CommentPress.ajax.comments.reassign_comments();CommentPress.ajax.comments.initialise();CommentPress.ajax.comments.initialise_form();if(b.is_function_defined("bpgsites_init_elements")){bpgsites_init_elements()}};this.update_dom=function(d){var k,f,g,h,c,e,i,j;k=b(".post",d);f=k.prop("id").split("-")[1];g=k.prop("class");if(g!="post"){menu_item_id=g.split("-")[1];if(g.match("wpcustom_menuid-")){CommentPress.infinite.menu.update_custom(menu_item_id)}else{CommentPress.infinite.menu.update_pages(menu_item_id)}b("#wrapper").waypoint("disable");c=b("#main_wrapper");e=d.prev();e.waypoint("destroy");d.waypoint("destroy");c.css("position","fixed");e.remove();document.title=CommentPress.infinite.settings.get_post_title();if(window.history){i=b.trim(d.html());window.history.pushState({post_id:f,post_permalink:CommentPress.infinite.settings.get_post_url(),page_title:CommentPress.infinite.settings.get_post_title(),html:i,comment_status:cp_comments_open},"",CommentPress.infinite.settings.get_post_url())}b(document).scrollTop(0);c.css("position","relative");b("#wrapper").waypoint("enable");j=CommentPress.infinite.settings.get_comments();if(CommentPress.infinite.commentform.get_comments_form()!==0){addComment.disableForm()}b("#comments_sidebar .comments_container").replaceWith(j);cp_comments_open=CommentPress.infinite.settings.get_post_comments_open();if(CommentPress.infinite.commentform.get_comments_form()!==0){addComment.enableForm()}CommentPress.infinite.DOM.refresh();b.waypoints("refresh");b(document).trigger("commentpress-post-changed")}}};CommentPress.infinite.page=new function(){var a=this,b=jQuery.noConflict();this.init=function(){a.init_nonce()};this.dom_ready=function(){a.state_navigation()};this.cpajax_nonce="";this.init_nonce=function(){if("undefined"!==typeof CommentpressAjaxInfiniteSettings){this.cpajax_nonce=CommentpressAjaxInfiniteSettings.nonce}};this.set_nonce=function(c){this.cpajax_nonce=c};this.get_nonce=function(){return this.cpajax_nonce};this.state_navigation=function(){b("#container").on("click",".previous_page",function(c){alert("back");if(c.preventDefault){c.preventDefault()}window.history.back()});b("#container").on("click",".next_page",function(c){alert("forward");if(c.preventDefault){c.preventDefault()}a.load_next("link")})};this.load_next=function(d){var c;c=b("#main_wrapper .post:last-child").prop("id").split("-")[1];if(CommentPress.infinite.settings.in_posts(c)){return}b("#main_wrapper").after('<div class="cp_next_page_loading_wrapper" style="text-align: center"><img src="'+cpajax_spinner_url+'" id="cp_next_page_loading" alt="'+cpajax_lang[0]+'" /></div>');b.ajax({url:cpajax_ajax_url,type:"POST",dataType:"json",data:{action:"cpajax_load_next_page",current_post_id:c,nonce:a.get_nonce()},success:function(e){CommentPress.infinite.DOM.handle_ajax_data(e,d);b(".cp_next_page_loading_wrapper").remove()}})}};CommentPress.infinite.menu=new function(){var a=this,b=jQuery.noConflict();this.init=function(){};this.dom_ready=function(){};this.update_custom=function(c){b("#toc_list .menu-item").removeClass("current_page_item");b("#menu-item-"+c).addClass("current_page_item");b("#toc_list .menu-item").removeClass("current_page_ancestor");b("#menu-item-"+c).parents("li").addClass("current_page_ancestor")};this.CommentPress.infinite.menu.update_pages=function(c){b("#toc_list .page_item").removeClass("current_page_item");b(".page-item-"+c).addClass("current_page_item");b("#toc_list .page_item").removeClass("current_page_ancestor");b(".page-item-"+c).parents("li").addClass("current_page_ancestor")}};CommentPress.infinite.comments=new function(){var a=this,b=jQuery.noConflict();this.init=function(){};this.dom_ready=function(){};this.store=function(){var c;c=b("#wrapper .post").prop("id").split("-")[1];CommentPress.infinite.settings_add_to_comments(c,b("#comments_sidebar .comments_container"))}};CommentPress.infinite.commentform=new function(){var a=this,b=jQuery.noConflict();this.init=function(){};this.dom_ready=function(){a.store()};this.comments_form=0;this.set_comments_form=function(c){this.comments_form=c};this.get_comments_form=function(){return this.comments_form};this.store=function(){var c;addComment.disableForm();a.set_comments_form(b("#respond_wrapper").clone());c=a.get_comments_form();b("form",c).attr("id","commentform-disabled");if(b("#respond_wrapper",c).hasClass("cp_force_displayed")){b("#respond_wrapper",c).removeClass("cp_force_displayed")}if(b("#respond_wrapper",c).hasClass("cp_force_closed")){b("#respond_wrapper",c).removeClass("cp_force_closed")}if(b("#respond_wrapper").hasClass("cp_force_closed")){b("#respond_wrapper").remove()}}};CommentPress.infinite.settings.init();CommentPress.infinite.DOM.init();CommentPress.infinite.page.init();CommentPress.infinite.menu.init();CommentPress.infinite.commentform.init();CommentPress.infinite.comments.init();jQuery(document).ready(function(a){CommentPress.infinite.settings.dom_ready();CommentPress.infinite.DOM.dom_ready();CommentPress.infinite.page.dom_ready();CommentPress.infinite.menu.dom_ready();CommentPress.infinite.commentform.dom_ready();CommentPress.infinite.comments.dom_ready()});