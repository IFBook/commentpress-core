var cpajax_infinite_posts=new Array,cpajax_infinite_comments=new Array,cpajax_comment_form=0,cpajax_comments_open="n",cpajax_post_url=document.location.href,cpajax_post_title=document.title;CommentPress.infinite={},CommentPress.infinite.DOM=new function(){var e=this,t=jQuery.noConflict();this.init=function(){},this.dom_ready=function(){e.init_waypoints(),e.init_popstate()},this.init_popstate=function(){window.onpopstate=function(e){e.state&&(document.title=e.state.page_title,t("#main_wrapper").prepend('<div class="page_wrapper cp_page_wrapper">'+e.state.html+"</div>"))}},this.init_waypoints=function(){t("#wrapper").waypoint(function(e){"down"===e&&CommentPress.infinite.page.load_next("waypoint")},{offset:"bottom-in-view"})},this.init_post_waypoint=function(n){t("#post-"+n+".post").parent().parent().waypoint(function(n){"down"===n&&e.update_dom(t(this))},{triggerOnce:!0,offset:function(){var e;return e=t("#header").height(),"y"==CommentPress.settings.DOM.get_wp_adminbar()&&(e+=CommentPress.settings.DOM.get_wp_adminbar_height()),e}})},this.handle_ajax_data=function(n,i){var o,a,s,m,r,p,c,_;_=t("#main_wrapper .post:last-child").prop("id").split("-")[1],cpajax_post_url=n.url,cpajax_post_title=n.title,m=t("#main_wrapper .post:last-child").prop("class"),o=t(".post",t(n.content)),t("#main_wrapper").append(o.parents(".page_wrapper")),a=o.prop("id"),"undefined"!=typeof a&&(cpajax_infinite_posts.push(_),s=a.split("-")[1],p=t(".comments_container",t(n.comments)),0!==cpajax_comment_form&&(c=cpajax_comment_form.clone(),t("form",c).attr("id","commentform"),t("#comment_post_ID",c).val(s),cpajax_infinite_comments=p.append(c),cpajax_comments_open="n","open"==n.comment_status&&(cpajax_comments_open="y")),"post"!=m&&(r=m.split("-")[1],m.match("wpcustom_menuid-")?CommentPress.infinite.menu.update_custom(r):CommentPress.infinite.menu.update_pages(r)),e.init_post_waypoint(s),t(document).trigger("commentpress-new-post-loaded"),e.refresh()),t.waypoints("refresh"),"link"==i&&CommentPress.common.content.scroll_page(o)},this.refresh=function(){CommentPress.ajax.comments.reassign_comments(),CommentPress.ajax.comments.initialise(),CommentPress.ajax.comments.initialise_form(),t.is_function_defined("bpgsites_init_elements")&&bpgsites_init_elements()},this.update_dom=function(e){var n,i,o,a,s,m,r;n=t(".post",e),i=n.prop("id").split("-")[1],o=n.prop("class"),"post"!=o&&(menu_item_id=o.split("-")[1],o.match("wpcustom_menuid-")?CommentPress.infinite.menu.update_custom(menu_item_id):CommentPress.infinite.menu.update_pages(menu_item_id),t("#wrapper").waypoint("disable"),a=t("#main_wrapper"),s=e.prev(),s.waypoint("destroy"),e.waypoint("destroy"),a.css("position","fixed"),s.remove(),document.title=cpajax_post_title,window.history&&(m=t.trim(e.html()),window.history.pushState({post_id:i,post_permalink:cpajax_post_url,page_title:cpajax_post_title,html:m,comment_status:cp_comments_open},"",cpajax_post_url)),t(document).scrollTop(0),a.css("position","relative"),t("#wrapper").waypoint("enable"),r=cpajax_infinite_comments,0!==cpajax_comment_form&&addComment.disableForm(),t("#comments_sidebar .comments_container").replaceWith(r),cp_comments_open=cpajax_comments_open,0!==cpajax_comment_form&&addComment.enableForm(),CommentPress.infinite.DOM.refresh(),t.waypoints("refresh"),t(document).trigger("commentpress-post-changed"))}},CommentPress.infinite.page=new function(){var e=this,t=jQuery.noConflict();this.init=function(){e.init_nonce()},this.dom_ready=function(){e.state_navigation()},this.cpajax_nonce="",this.init_nonce=function(e){"undefined"!=typeof CommentpressAjaxInfiniteSettings&&(this.cpajax_nonce=CommentpressAjaxInfiniteSettings.nonce)},this.set_nonce=function(e){this.cpajax_nonce=e},this.get_nonce=function(){return this.cpajax_nonce},this.state_navigation=function(){t("#container").on("click",".previous_page",function(e){alert("back"),e.preventDefault&&e.preventDefault(),window.history.back()}),t("#container").on("click",".next_page",function(t){alert("forward"),t.preventDefault&&t.preventDefault(),e.load_next("link")})},this.load_next=function(n){var i;i=t("#main_wrapper .post:last-child").prop("id").split("-")[1],t.in_array(i,cpajax_infinite_posts)||(t("#main_wrapper").after('<div class="cp_next_page_loading_wrapper" style="text-align: center"><img src="'+cpajax_spinner_url+'" id="cp_next_page_loading" alt="'+cpajax_lang[0]+'" /></div>'),t.ajax({url:cpajax_ajax_url,type:"POST",dataType:"json",data:{action:"cpajax_load_next_page",current_post_id:i,nonce:e.get_nonce()},success:function(e){CommentPress.infinite.DOM.handle_ajax_data(e,n),t(".cp_next_page_loading_wrapper").remove()}}))}},CommentPress.infinite.menu=new function(){var e=jQuery.noConflict();this.init=function(){},this.dom_ready=function(){},this.update_custom=function(t){e("#toc_list .menu-item").removeClass("current_page_item"),e("#menu-item-"+t).addClass("current_page_item"),e("#toc_list .menu-item").removeClass("current_page_ancestor"),e("#menu-item-"+t).parents("li").addClass("current_page_ancestor")},this.CommentPress.infinite.menu.update_pages=function(t){e("#toc_list .page_item").removeClass("current_page_item"),e(".page-item-"+t).addClass("current_page_item"),e("#toc_list .page_item").removeClass("current_page_ancestor"),e(".page-item-"+t).parents("li").addClass("current_page_ancestor")}},CommentPress.infinite.comments=new function(){var e=jQuery.noConflict();this.init=function(){},this.dom_ready=function(){},thsi.store=function(){var t;t=e("#wrapper .post").prop("id").split("-")[1],cpajax_infinite_comments[t]=e("#comments_sidebar .comments_container")}},CommentPress.infinite.commentform=new function(){var e=this,t=jQuery.noConflict();this.init=function(){},this.dom_ready=function(){e.store()},this.store=function(){addComment.disableForm(),cpajax_comment_form=t("#respond_wrapper").clone(),t("form",cpajax_comment_form).attr("id","commentform-disabled"),t("#respond_wrapper",cpajax_comment_form).hasClass("cp_force_displayed")&&t("#respond_wrapper",cpajax_comment_form).removeClass("cp_force_displayed"),t("#respond_wrapper",cpajax_comment_form).hasClass("cp_force_closed")&&t("#respond_wrapper",cpajax_comment_form).removeClass("cp_force_closed"),t("#respond_wrapper").hasClass("cp_force_closed")&&t("#respond_wrapper").remove()}},CommentPress.infinite.DOM.init(),CommentPress.infinite.page.init(),CommentPress.infinite.menu.init(),CommentPress.infinite.commentform.init(),CommentPress.infinite.comments.init(),jQuery(document).ready(function(e){CommentPress.infinite.DOM.dom_ready(),CommentPress.infinite.page.dom_ready(),CommentPress.infinite.menu.dom_ready(),CommentPress.infinite.commentform.dom_ready(),CommentPress.infinite.comments.dom_ready()});