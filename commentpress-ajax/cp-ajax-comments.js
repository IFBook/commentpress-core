var cpajax_live,cpajax_ajax_url,cpajax_spinner_url,cpajax_post_id,cpajax_submitting,cpajax_lang,cpajax_form,cpajax_error;if("undefined"!==typeof CommentpressAjaxSettings){cpajax_live=CommentpressAjaxSettings.cpajax_live;cpajax_ajax_url=CommentpressAjaxSettings.cpajax_ajax_url;cpajax_spinner_url=CommentpressAjaxSettings.cpajax_spinner_url;cpajax_post_id=CommentpressAjaxSettings.cpajax_post_id;cpajax_lang=CommentpressAjaxSettings.cpajax_lang}cpajax_submitting=false;function cpajax_initialise(){jQuery("#respond_title").after('<div id="cpajax_error_msg"></div>');jQuery("#submit").after('<img src="'+cpajax_spinner_url+'" id="loading" alt="'+cpajax_lang[0]+'" />');jQuery("#loading").hide();cpajax_form=jQuery("#commentform");cpajax_error=jQuery("#cpajax_error_msg");cpajax_error.hide()}function cpajax_reenable_featured_comments(){if("undefined"!==typeof featured_comments){if(jQuery.is_function_defined("featured_comments_click")){featured_comments_click()}}}function cpajax_reenable_comment_upvoter(){if("undefined"!==typeof comment_upvoter){if(jQuery.is_function_defined("comment_upvoter_click")){comment_upvoter_click()}}}function cpajax_ajax_callback(data){var diff,i,comment;diff=parseInt(data.cpajax_comment_count)-parseInt(CommentpressAjaxSettings.cpajax_comment_count);if(diff>0){for(i=1;i<=diff;i++){comment=eval("data.cpajax_new_comment_"+i);cpajax_add_new_comment(jQuery(comment.markup),comment.text_sig,comment.parent,comment.id);CommentpressAjaxSettings.cpajax_comment_count++}}}function cpajax_add_new_comment(m,k,e,d){var l,a,g,i,f,c,h,j,b,n;l=jQuery("div.comments_container");if(l.find("#li-comment-"+d)[0]){return}a="#para_wrapper-"+k;g="#para_heading-"+k;i=jQuery(a+" ol.commentlist:first");if(e!="0"){f="#li-comment-"+e;c=jQuery(f+" > ol.children:first");if(c[0]){m.hide().addClass("comment-highlighted").appendTo(c).slideDown("fast",function(){m.addClass("comment-fade")})}else{m.wrap('<ol class="children" />').parent().addClass("comment-highlighted").hide().appendTo(f).slideDown("fast",function(){m.parent().addClass("comment-fade")})}}else{if(i[0]){m.hide().addClass("comment-highlighted").appendTo(i).slideDown("fast",function(){m.addClass("comment-fade")})}else{m.wrap('<ol class="commentlist" />').parent().addClass("comment-highlighted").hide().prependTo(a).slideDown("fast",function(){m.parent().addClass("comment-fade")})}}b=parseInt(jQuery(g+" a span.cp_comment_num").text());n=b+1;cpajax_update_comments_para_heading(g,n);h=jQuery(g);h.addClass("notransition");if(h.hasClass("heading-fade")){h.removeClass("heading-fade")}if(h.hasClass("heading-highlighted")){h.removeClass("heading-highlighted")}h.addClass("heading-highlighted");h.removeClass("notransition");h.height();h.addClass("heading-fade");cpajax_update_para_icon(k,n);commentpress_enable_comment_permalink_clicks();commentpress_setup_comment_headers();cpajax_reassign_comments();cpajax_reenable_featured_comments();cpajax_reenable_comment_upvoter()}function cpajax_ajax_update(){if(cpajax_submitting){return}jQuery.post(cpajax_ajax_url,{action:"cpajax_get_new_comments",last_count:CommentpressAjaxSettings.cpajax_comment_count,post_id:cpajax_post_id},function(a,b){if(b=="success"){cpajax_ajax_callback(a)}},"json")}function cpajax_ajax_updater(a){if(a=="1"){CommentpressAjaxSettings.interval=window.setInterval(cpajax_ajax_update,5000)}else{window.clearInterval(CommentpressAjaxSettings.interval)}}function cpajax_reassign_comments(){var d,f,b,a,c,e;var d=jQuery("#comments_sidebar .comment-wrapper .comment-assign");d.show();d.draggable({helper:"clone",cursor:"move"});f=jQuery("#content .post .textblock");f.droppable({accept:".comment-assign",hoverClass:"selected_para selected_dropzone",drop:function(g,h){b=jQuery(this).prop("id").split("-")[1];a={resizable:false,height:160,zIndex:3999,modal:true,dialogClass:"wp-dialog",buttons:{Yes:function(){jQuery(this).dialog("option","disabled",true);jQuery(".ui-dialog-buttonset").html('<img src="'+cpajax_spinner_url+'" id="loading" alt="'+cpajax_lang[0]+'" />');jQuery(".ui-dialog-title").html(cpajax_lang[9]);jQuery(".cp_alert_text").html(cpajax_lang[10]);cpajax_reassign(b,h)},Cancel:function(){jQuery(this).dialog("close");jQuery(this).dialog("destroy");jQuery(this).remove()}}};c=cpajax_lang[8];e=jQuery('<div><p class="cp_alert_text">'+c+"</p></div>");e.prop("title",cpajax_lang[7]).appendTo("body").dialog(a)}})}function cpajax_reassign(d,e){var c,f,b,a,g;c=jQuery(e.draggable).prop("id").split("-")[1];f=jQuery(e.draggable).closest("li.comment");b=f;a=f.siblings("li.comment");if(a.length==0){g=f.parent("ol.commentlist");b=g}jQuery(b).slideUp("slow",function(){jQuery.post(cpajax_ajax_url,{action:"cpajax_reassign_comment",text_signature:d,comment_id:c},function(h,i){if(i=="success"){document.location.reload(true)}else{alert(i)}},"json")})}function cpajax_reset(){jQuery("#loading").hide();jQuery("#submit").removeAttr("disabled");jQuery("#submit").show();addComment.enableForm();cpajax_submitting=false}function cpajax_add_comment(c){var i,e,a,f,g,d,h,b,j;i=cpajax_form.find("#text_signature").val();e=cpajax_form.find("#comment_parent").val();a="#para_wrapper-"+i;f="#para_heading-"+i;jQuery(a).removeClass("no_comments");if(e!="0"){g="#li-comment-"+e;d=jQuery(g+" > ol.children:first");if(d[0]){cpajax_nice_append(c,g+" > ol.children:first > li:last",d,g+" > ol.children:first > li:last")}else{cpajax_nice_append(c,g+" > ol.children:first",g,g+" > ol.children:first > li:last")}}else{h=jQuery(a+" > ol.commentlist:first");if(h[0]){cpajax_nice_append(c,a+" > ol.commentlist:first > li:last",h,a+" > ol.commentlist:first > li:last")}else{cpajax_nice_prepend(c,a+" > ol.commentlist:first",a,a+" > ol.commentlist:first > li:last")}}jQuery("#respond").slideUp("fast",function(){addComment.cancelForm()});b=parseInt(jQuery(f+" a span.cp_comment_num").text());j=b+1;cpajax_update_comments_para_heading(f,j);cpajax_update_para_icon(i,j);if(i!=""){commentpress_scroll_page(jQuery("#textblock-"+i))}else{commentpress_scroll_to_top(0,cp_scroll_speed)}commentpress_enable_comment_permalink_clicks();commentpress_setup_comment_headers();cpajax_reassign_comments();cpajax_form.find("#comment").val("");cpajax_reenable_featured_comments();cpajax_reenable_comment_upvoter()}function cpajax_nice_append(a,c,d,b){if(a===undefined||a===null){return}a.find(c).hide().appendTo(d);cpajax_cleanup(c,b)}function cpajax_nice_prepend(a,c,d,b){if(a===undefined||a===null){return}a.find(c).hide().prependTo(d);cpajax_cleanup(c,b)}function cpajax_cleanup(c,b){var a,d,e;a=jQuery(b).prop("id");d="#comment-"+(a.toString().split("-")[2]);e=jQuery(d);e.addClass("comment-highlighted");jQuery(c).slideDown("slow",function(){jQuery("#comments_sidebar .sidebar_contents_wrapper").scrollTo(e,{duration:cp_scroll_speed,axis:"y",onAfter:function(){e.addClass("comment-fade")}})})}function cpajax_update_comments_para_heading(b,a){jQuery(b+" a span.cp_comment_num").text(a.toString());if(a==1){jQuery(b+" a span.cp_comment_word").text(cpajax_lang[11])}if(a>1){jQuery(b+" a span.cp_comment_word").text(cpajax_lang[12])}}function cpajax_update_para_icon(c,a){var b;b="#textblock-"+c;jQuery(b+" span small").text(a.toString());if(a==1){jQuery(b+" span.commenticonbox a.para_permalink").addClass("has_comments");jQuery(b+" span small").css("visibility","visible")}}jQuery(document).ready(function(a){cpajax_ajax_updater(cpajax_live);cpajax_reassign_comments();cpajax_initialise();jQuery("#commentform").on("submit",function(c){var b;cpajax_submitting=true;cpajax_error.hide();if(cpajax_form.find("#author")[0]){if(cpajax_form.find("#author").val()==""){cpajax_error.html('<span class="error">'+cpajax_lang[1]+"</span>");cpajax_error.show();cpajax_submitting=false;return false}if(cpajax_form.find("#email").val()==""){cpajax_error.html('<span class="error">'+cpajax_lang[2]+"</span>");cpajax_error.show();cpajax_submitting=false;return false}b=/^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/;if(!b.test(cpajax_form.find("#email").val())){cpajax_error.html('<span class="error">'+cpajax_lang[3]+"</span>");cpajax_error.show();if(c.preventDefault){c.preventDefault()}cpajax_submitting=false;return false}}if(cp_tinymce=="1"){tinyMCE.triggerSave();addComment.disableForm()}if(cpajax_form.find("#comment").val()==""){cpajax_error.html('<span class="error">'+cpajax_lang[4]+"</span>");cpajax_error.show();addComment.enableForm();cpajax_submitting=false;return false}jQuery(this).ajaxSubmit({beforeSubmit:function(){jQuery("#loading").show();jQuery("#submit").prop("disabled","disabled");jQuery("#submit").hide()},error:function(d){var e;cpajax_error.empty();e=d.responseText.match(/<p>(.*)<\/p>/);cpajax_error.html('<span class="error">'+e[1]+"</span>");cpajax_error.show();cpajax_reset();return false},success:function(f){var d;try{if(jQuery.parseHTML){d=jQuery(jQuery.parseHTML(f))}else{d=jQuery(f)}cpajax_add_comment(d);cpajax_reset()}catch(g){cpajax_reset();alert(cpajax_lang[6]+"\n\n"+g)}}});return false})});